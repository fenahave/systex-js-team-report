= JavaScript å ±å‘Š

== ç›®éŒ„
- ç¬¬ä¸€çµ„(èªæ³•åŠå‹åˆ¥)
* link:#å…·åå‡½å¼åŒ¿åå‡½å¼[å…·åå‡½å¼/åŒ¿åå‡½å¼]
* link:#automatic-semicolon-insertion-asi[Automatic Semicolon Insertion, ASI]
* link:#åŸå§‹å‹åˆ¥ç‰©ä»¶å‹åˆ¥[åŸå§‹å‹åˆ¥/ç‰©ä»¶å‹åˆ¥]
* link:#é¡¯æ€§è½‰æ›éš±æ€§è½‰æ›[é¡¯æ€§è½‰æ›/éš±æ€§è½‰æ›]
* link:#å‹åˆ¥æ¯”è¼ƒ[å‹åˆ¥æ¯”è¼ƒ]

- ä¸åˆ†çµ„
* link:#iife-èˆ‡-é«˜éšå‡½å¼[å‡½å¼(IIFE èˆ‡ é«˜éšå‡½å¼)]
* link:#å‡½å¼é–‰åŒ…thisç®­é ­å‡½å¼[å‡½å¼(é–‰åŒ…ã€thisã€ç®­é ­å‡½å¼)]
* link:#éåŒæ­¥åŒæ­¥éåŒæ­¥å·®ç•°xmlhttprequestfetchajaxpromise[éåŒæ­¥(åŒæ­¥/éåŒæ­¥å·®ç•°ã€XMLHttpRequest/fetchã€AJAXã€Promise)]
* link:promise-èˆ‡éåŒæ­¥è™•ç†[éåŒæ­¥(async/awaitã€tryâ€¦â€‹catch èˆ‡éåŒæ­¥)]

== å…·åå‡½å¼/åŒ¿åå‡½å¼

=== 1. å…·åå‡½å¼ï¼ˆNamed Functionsï¼‰

å…·åå‡½å¼æ˜¯æŒ‡åœ¨å®šç¾©å‡½å¼æ™‚çµ¦å®ƒä¸€å€‹åç¨±ã€‚é€™æ¨£å¯ä»¥æ–¹ä¾¿åœ¨ç¨‹å¼ä¸­èª¿ç”¨é€™å€‹å‡½å¼ã€‚å…·åå‡½å¼çš„ä¸»è¦å„ªé»æ˜¯å¯ä»¥æ¸…æ™°åœ°è¡¨é”å‡½å¼çš„ç›®çš„ï¼Œä¸¦ä¸”å¯ä»¥åœ¨èª¿è©¦æ™‚æä¾›å †ç–Šè·Ÿè¹¤ä¿¡æ¯ã€‚

==== å®šç¾©ï¼š

[source,javascript]
----
function myFunction() {
    console.log("é€™æ˜¯ä¸€å€‹å…·åå‡½å¼");
}
----

==== ä½¿ç”¨ï¼š

[source,javascript]
----
myFunction();  // è¼¸å‡ºï¼šé€™æ˜¯ä¸€å€‹å…·åå‡½å¼
----

é€šå¸¸å…·åå‡½å¼ç”¨æ–¼æœ‰å€‹ç›¸åŒçš„åŠŸèƒ½éœ€è¦è¢«é‡è¤‡è¢«ä½¿ç”¨çš„ï¼Œæˆ–æ˜¯æƒ³å°‡è¤‡é›œçš„é‚è¼¯æ‹†è§£çš„æƒ…æ³ï¼Œ
æ¯”å¦‚ç¾åœ¨è¦å¯«ä¸€å€‹é»æ“Šbuttonå¾Œï¼Œæ ¹æ“šinputå…§çš„å€¼å›å‚³å°æ‡‰çš„çµæœã€‚
åœ¨æ²’æœ‰ä½¿ç”¨å…·åæ–¹æ³•çš„æƒ…æ³ï¼Œè‹¥ä¹‹å¾Œæœ‰è¶Šä¾†è¶Šå¤šçš„ buttonï¼Œç¨‹å¼æœƒè¶Šä¾†è¶Šé›£ç¶­è­·ã€‚

[source,javascript]
----
//  button1
document.getElementById("button1").addEventListener("click",function() {
    let value = document.getElementById("input2").value;
    console.log(value);
})

// button2
document.getElementById("button2").addEventListener("click",function() {
    let value = document.getElementById("input2").value;
    console.log(value);
})
----


é€™æ™‚å€™å°‡é‡è¤‡çš„ç¨‹å¼ç¢¼å…§å®¹å–å‡ºå¯«æˆæ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°ç¨‹å¼ç¢¼è®Šå¾—æ¯”è¼ƒç°¡å–®æ˜“æ‡‚ä¸€äº›ï¼Œå°±
ç®—ä»Šå¤©æœ‰5å€‹buttonè¦ç›£è½ï¼Œä¹Ÿæ¯”æ²’æœ‰ç”¨çš„æƒ…æ³å¥½ç†è§£ä¸€é»ã€‚é‡é»æ˜¯æœªä¾†è¦ä¿®æ”¹æ™‚ï¼Œ
åªéœ€è¦ä¿®æ”¹ function æœ¬èº«å°±å¯ä»¥ä¸€æ¬¡æ€§ä¿®æ”¹æ‰€æœ‰ button çš„ç›£è½äº‹ä»¶

[source,javascript]
----
/**
 * æ·»åŠ ç›£è½ï¼Œä¸¦å°å‡º input çš„ value
 * @param button è¦ç›£è½çš„button id
 * @param input è¦è®€å–çš„input id
 */
function getValueAndConsole(button, input) {
    document.getElementById(button).addEventListener("click",function() {
        let value = document.getElementById(input).value;
        console.log(value);
    })
}

getValueAndConsole("button1", "input1");
getValueAndConsole("button2", "input2");
----

==== å„ªé»ï¼š

* *å¯è®€æ€§*ï¼šå…·åå‡½å¼é€šå¸¸æ›´å…·å¯è®€æ€§ï¼Œå› ç‚ºåç¨±å¯ä»¥æè¿°å‡½å¼çš„åŠŸèƒ½ã€‚
* *æ¨¡çµ„åŒ–*ï¼š å¯ä»¥è®“ç¨‹å¼æ›´æ˜“æ–¼æ‹†åˆ†ç‚ºå¯é‡ç”¨çš„æ¨¡çµ„ï¼Œæ¯å€‹å‡½å¼éƒ½æœ‰æ˜ç¢ºçš„åç¨±å’ŒåŠŸèƒ½ï¼Œä¿ƒé€²ä»£ç¢¼çš„çµ„ç¹”æ€§å’Œç¶­è­·æ€§
* *å †ç–Šè·Ÿè¹¤*ï¼šåœ¨ç™¼ç”ŸéŒ¯èª¤æ™‚ï¼Œå †ç–Šè·Ÿè¹¤æœƒé¡¯ç¤ºå…·åå‡½å¼çš„åç¨±ï¼Œä¾¿æ–¼èª¿è©¦ã€‚


=== 2. åŒ¿åå‡½å¼ï¼ˆAnonymous Functionsï¼‰

åŒ¿åå‡½å¼æ˜¯æŒ‡åœ¨å®šç¾©æ™‚æ²’æœ‰çµ¦å®ƒèµ·åç¨±çš„å‡½å¼ã€‚é€šå¸¸ï¼ŒåŒ¿åå‡½å¼ç”¨æ–¼ä¸€æ¬¡æ€§ä½¿ç”¨çš„å ´æ™¯ï¼Œä¾‹å¦‚ä½œç‚ºå›èª¿å‡½å¼æˆ–åœ¨ç«‹å³åŸ·è¡Œå‡½å¼è¡¨é”å¼ï¼ˆIIFEï¼‰ä¸­ä½¿ç”¨ã€‚

==== å®šç¾©ï¼š

[source,javascript]
----
const myAnonymousFunction = function() {
console.log("é€™æ˜¯ä¸€å€‹åŒ¿åå‡½å¼");
};
----

==== ä½¿ç”¨ï¼š

[source,javascript]
----
myAnonymousFunction();  // è¼¸å‡ºï¼šé€™æ˜¯ä¸€å€‹åŒ¿åå‡½å¼
----

==== åœ¨å›èª¿ä¸­çš„ä½¿ç”¨ï¼š

[source,javascript]
----
setTimeout(function() {
console.log("é€™æ˜¯ä¸€å€‹åŒ¿åå›èª¿å‡½å¼");
}, 1000);
----

==== å„ªé»ï¼š

* *éˆæ´»æ€§*ï¼šåŒ¿åå‡½å¼å¯ä»¥åœ¨éœ€è¦çš„åœ°æ–¹ç›´æ¥ä½¿ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å‚³éçµ¦å…¶ä»–å‡½å¼ä½œç‚ºå›èª¿æ™‚ã€‚
* *ç°¡æ½”æ€§*ï¼šåœ¨ç°¡å–®çš„å ´æ™¯ä¸­ï¼Œä¸éœ€è¦ç‚ºå‡½å¼å‘½åï¼Œå¯ä»¥ç°¡åŒ–ä»£ç¢¼ã€‚


==== 3. ç«‹å³åŸ·è¡Œå‡½å¼è¡¨é”å¼ï¼ˆIIFEï¼‰

åŒ¿åå‡½å¼ç¶“å¸¸èˆ‡ç«‹å³åŸ·è¡Œå‡½å¼è¡¨é”å¼ä¸€èµ·ä½¿ç”¨ï¼Œé€™æ˜¯ä¸€ç¨®åœ¨å®šç¾©å‡½å¼å¾Œç«‹å³åŸ·è¡Œå®ƒçš„æ–¹å¼ã€‚

==== å®šç¾©å’Œä½¿ç”¨ï¼š

[source,javascript]
----
(function() {
console.log("é€™æ˜¯ä¸€å€‹ç«‹å³åŸ·è¡Œçš„åŒ¿åå‡½å¼");
})();  // è¼¸å‡ºï¼šé€™æ˜¯ä¸€å€‹ç«‹å³åŸ·è¡Œçš„åŒ¿åå‡½å¼
----

=== 4. å…·åå‡½å¼å †ç–Šè·Ÿè¹¤

å…·åå‡½å¼å †ç–Šè·Ÿè¹¤ï¼ˆNamed Function Stack Traceï¼‰æ˜¯ç¨‹å¼é‹è¡Œéç¨‹ä¸­ï¼Œç•¶ç™¼ç”ŸéŒ¯èª¤æˆ–ç•°å¸¸æ™‚ï¼Œé¡¯ç¤ºå‡ºå“ªäº›å‡½å¼ä¾åºè¢«å‘¼å«ï¼Œç›´åˆ°å‡ºç¾å•é¡Œçš„ä½ç½®ã€‚é€™å°æ–¼é™¤éŒ¯éå¸¸æœ‰ç”¨ï¼Œå› ç‚ºå®ƒå¯ä»¥å¹«åŠ©æˆ‘å€‘äº†è§£éŒ¯èª¤ç™¼ç”Ÿæ™‚çš„åŸ·è¡Œè·¯å¾‘ã€‚

[source, javascript]
----
function functionA() {
    console.log("In function A");
    functionB();
}

function functionB() {
    console.log("In function B");
    functionC();
}

function functionC() {
    console.log("In function C");
    throw new Error("Something went wrong!");
}

try {
    functionA();
} catch (error) {
    console.error("Error caught:", error);
    console.error(error.stack);
}
----

==== è§£é‡‹

* 1. `functionA` å‘¼å«äº† `functionB`ï¼Œè€Œ `functionB` åˆå‘¼å«äº† `functionC`ã€‚
* 2. åœ¨ `functionC` ä¸­ï¼Œæˆ‘å€‘æ•…æ„æ‹‹å‡ºä¸€å€‹éŒ¯èª¤ `Error("Something went wrong!")`ã€‚
* 3. `try-catch` å¡ŠæŠ“å–é€™å€‹éŒ¯èª¤ï¼Œä¸¦ä¸”æ‰“å°å‡ºéŒ¯èª¤è¨Šæ¯å’Œå †ç–Šè·Ÿè¹¤ã€‚

==== å †ç–Šè·Ÿè¹¤è¼¸å‡ºï¼ˆç¯„ä¾‹ï¼‰

ç•¶é‹è¡Œé€™å€‹ç¨‹å¼æ™‚ï¼Œè¼¸å‡ºçš„å †ç–Šè·Ÿè¹¤å¯èƒ½çœ‹èµ·ä¾†åƒé€™æ¨£ï¼š

[source, text]
----
Error: Something went wrong!
at functionC (index.js:12:11)
at functionB (index.js:8:5)
at functionA (index.js:4:5)
at anonymous :16:5
----

==== å †ç–Šè·Ÿè¹¤èªªæ˜

* `functionC` æ˜¯æœ€æ¥è¿‘éŒ¯èª¤ç™¼ç”Ÿçš„å‡½å¼ï¼Œå› æ­¤å®ƒåœ¨å †ç–Šçš„é ‚ç«¯ã€‚
* ç„¶å¾Œä¾åºæ˜¯ `functionB` å’Œ `functionA`ï¼Œå› ç‚ºå®ƒå€‘æ˜¯å‘¼å« `functionC` çš„å‡½å¼ã€‚
* æœ€å¾Œï¼Œå †ç–Šå›åˆ°äº†åŒ¿åå‡½å¼ï¼ˆå³æœ€å¤–å±¤çš„ `try-catch` å€å¡Šï¼‰ã€‚

==== åœ–ç‰‡èªªæ˜é‚è¼¯

image::../images/Stack.png[]

é€™å¼µåœ–è¡¨é¡¯ç¤ºäº†å‡½å¼å‘¼å«å †ç–Šçš„é‚è¼¯ï¼Œå¾ `functionA` é–‹å§‹å‘¼å« `functionB`ï¼Œç„¶å¾Œ `functionB` å†å‘¼å« `functionC`ã€‚åœ¨ `functionC` ç™¼ç”ŸéŒ¯èª¤ï¼Œä¸¦ä¸”æœ€çµ‚åœ¨ç¨‹å¼çš„ `try-catch` å€å¡Šä¸­æ•æ‰åˆ°é€™å€‹éŒ¯èª¤ã€‚

å †ç–Šè·Ÿè¹¤æœ‰åŠ©æ–¼äº†è§£ç¨‹å¼åœ¨ç™¼ç”ŸéŒ¯èª¤æ™‚çš„åŸ·è¡Œæµç¨‹ã€‚ä½ å¯ä»¥çœ‹åˆ°æ¯å€‹å‡½å¼è¢«å‘¼å«çš„é †åºï¼Œä¸¦ä¸”ç­è§£éŒ¯èª¤å‡ºç¾çš„ä½ç½®ã€‚


=== ç¸½çµ

* *å…·åå‡½å¼*ï¼šæœ‰åŠ©æ–¼æé«˜ä»£ç¢¼çš„å¯è®€æ€§ï¼Œé©åˆé‡è¤‡ä½¿ç”¨çš„æƒ…æ³ã€‚
* *åŒ¿åå‡½å¼*ï¼šéˆæ´»ä¸”ç°¡æ½”ï¼Œé©åˆä¸€æ¬¡æ€§ä½¿ç”¨æˆ–ä½œç‚ºå›èª¿å‡½å¼ã€‚

== Automatic Semicolon Insertion, ASI

è‡ªå‹•æ’å…¥åˆ†è™Ÿ (Automatic Semicolon Insertion, ASI) æ˜¯ JavaScript çš„ä¸€å€‹ç‰¹æ€§ï¼Œå…è¨±åœ¨çœç•¥åˆ†è™Ÿæ™‚è‡ªå‹•è£œä¸Šã€‚é€™åœ¨å¤§éƒ¨åˆ†æƒ…æ³ä¸‹èƒ½æ­£å¸¸é‹ä½œï¼Œä½†ä¹Ÿæœ‰å¯èƒ½å°è‡´æ„æƒ³ä¸åˆ°çš„è¡Œç‚ºã€‚

=== è‡ªå‹•æ’å…¥åˆ†è™Ÿæ©Ÿåˆ¶

åœ¨æŸäº›æƒ…æ³ä¸‹ï¼Œç•¶ JavaScript è§£æå™¨é‡åˆ°ä¸€è¡Œç„¡åˆ†è™Ÿçš„çµå°¾æ™‚ï¼Œå®ƒæœƒå˜—è©¦è‡ªå‹•æ’å…¥åˆ†è™Ÿä¾†ä¿®æ­£ä»£ç¢¼ã€‚

[source, javascript]
----
let a = 5
let b = 10
console.log(a + b)
//è¼¸å‡º15
----

é€™è£¡ï¼Œé›–ç„¶æ¯è¡Œæœ«å°¾æ²’æœ‰åˆ†è™Ÿï¼ŒJavaScript è§£æå™¨æœƒè‡ªå‹•æ’å…¥åˆ†è™Ÿã€‚

=== è‡ªå‹•æ’å…¥åˆ†è™Ÿçš„è¦å‰‡

JavaScript æœƒåœ¨ä»¥ä¸‹æƒ…æ³ä¸‹è‡ªå‹•æ’å…¥åˆ†è™Ÿï¼š

* ç•¶èªå¥ä»¥æ›è¡Œç¬¦çµæŸæ™‚
* åœ¨é—œéµå­— `break`, `return`, `throw` å¾Œè·Ÿè‘—æ›è¡Œç¬¦æ™‚

[source, javascript]
----
return
5 + 10
----

é€™æ®µä»£ç¢¼æœƒè¢«è§£æç‚º `return;` å’Œ `5 + 10;`ï¼Œè€Œä¸æ˜¯ `return 5 + 10;`ã€‚

=== å¯èƒ½å›  ASI å¼•ç™¼çš„éŒ¯èª¤

ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½å›  ASI å¼•ç™¼éŒ¯èª¤çš„æƒ…æ³ï¼š

==== 1. è¿”å›å€¼çš„å•é¡Œ

ç•¶ `return` èªå¥å¾Œé¢æ›è¡Œç¬¦å‡ºç¾æ™‚ï¼Œå¯èƒ½å°è‡´ç„¡æ³•è¿”å›é æœŸå€¼ã€‚

[source, javascript]
----
function calculate() {
  return 
  { value: 10 }
}
console.log(calculate())
----

é€™æ®µä»£ç¢¼å¯¦éš›ä¸Šæœƒè¿”å› `undefined`ï¼Œå› ç‚º ASI åœ¨ `return` å¾Œæ’å…¥äº†åˆ†è™Ÿï¼Œå°è‡´ `{ value: 10 }` è¢«å¿½ç•¥ã€‚

==== 2. é™£åˆ—èˆ‡å‡½å¼çš„éŒ¯èª¤

ç•¶å‡½å¼çµæŸå¾Œç«‹å³è·Ÿè‘—é–‹é ­ç‚º `[` çš„é™£åˆ—æˆ– `(` çš„æ‹¬è™Ÿæ™‚ï¼Œå¯èƒ½æœƒç”¢ç”Ÿæ„å¤–è¡Œç‚ºã€‚

[source, javascript]
----
const foo = () => {}
[1, 2].forEach(console.log)
----

é€™è£¡ï¼ŒJavaScript æœƒå°‡å…©è¡Œç•¶ä½œå…©å€‹åˆ†é›¢çš„èªå¥ï¼Œè€Œä¸æ˜¯ä¸€å€‹å®Œæ•´çš„é‚è¼¯ï¼Œå¾è€Œå°è‡´éŒ¯èª¤ã€‚

==== 3. è‡ªå¢æˆ–è‡ªæ¸›é‹ç®—ç¬¦

åœ¨ä½¿ç”¨è‡ªå¢ (++) æˆ–è‡ªæ¸› (--) é‹ç®—ç¬¦æ™‚ï¼Œå¦‚æœæ”¾ç½®ä½ç½®ä¸ç•¶ï¼ŒASI å¯èƒ½æœƒéŒ¯èª¤åœ°æ’å…¥åˆ†è™Ÿã€‚

[source, javascript]
----
let i = 10
i
++
console.log(i)
----

Compiler æœƒå°‡å®ƒè¦–ç‚ºå…©å€‹ç¨ç«‹èªå¥ï¼Œçµæœ `i++` ä¸æœƒå¦‚é æœŸé‚£æ¨£å·¥ä½œï¼Œæœ€å¾Œè¼¸å‡ºçš„é‚„æ˜¯ `10`ã€‚

=== ç¸½çµ

ç‚ºäº†é¿å… ASI å¸¶ä¾†çš„æ½›åœ¨å•é¡Œï¼Œé–‹ç™¼è€…é€šå¸¸å»ºè­°å§‹çµ‚é¡¯å¼åœ°åœ¨èªå¥æœ«å°¾æ·»åŠ åˆ†è™Ÿã€‚é€™æ¨£å¯ä»¥æ¸›å°‘éŒ¯èª¤ä¸¦æé«˜ä»£ç¢¼çš„å¯è®€æ€§ã€‚


== åŸå§‹å‹åˆ¥/ç‰©ä»¶å‹åˆ¥

== 1. åŸå§‹å‹åˆ¥ï¼ˆPrimitive Typesï¼‰
åŸå§‹å‹åˆ¥æ˜¯æœ€åŸºæœ¬çš„æ•¸æ“šé¡å‹ï¼Œå®ƒå€‘æ˜¯ä¸å¯è®Šçš„ï¼ˆimmutableï¼‰ï¼Œä¸”ç›´æ¥å­˜å„²å…¶å€¼ã€‚JavaScript ä¸­çš„åŸå§‹å‹åˆ¥å…±æœ‰ 7 ç¨®ï¼š

* *string*ï¼šè¡¨ç¤ºå­—ä¸²ï¼Œä¾‹å¦‚ "Hello"
* *number*ï¼šè¡¨ç¤ºæ•¸å­—ï¼ŒåŒ…æ‹¬æ•´æ•¸å’Œæµ®é»æ•¸ï¼Œä¾‹å¦‚ 42ã€3.14
* *bigint*ï¼šè¡¨ç¤ºä»»æ„ç²¾åº¦çš„æ•´æ•¸ï¼Œä¾‹å¦‚ 9007199254740991n
* *boolean*ï¼šè¡¨ç¤ºå¸ƒæ—å€¼ true æˆ– false
* *undefined*ï¼šç•¶è®Šæ•¸å·²è²æ˜ä½†å°šæœªè³¦å€¼æ™‚ï¼Œå…¶å€¼æ˜¯ undefined
* *null*ï¼šè¡¨ç¤ºç©ºå€¼ï¼Œé€šå¸¸ç”¨ä¾†è¡¨ç¤ºâ€œç„¡â€çš„ç‹€æ…‹
* *symbol*ï¼šç”¨ä¾†å‰µå»ºå”¯ä¸€çš„æ¨™è­˜ç¬¦ï¼Œä¾‹å¦‚ Symbol("unique")

=== ç‰¹é»
* ä¸å¯è®Šæ€§ï¼šåŸå§‹å‹åˆ¥çš„å€¼ä¸èƒ½è¢«ä¿®æ”¹ï¼Œä»»ä½•å°å…¶å€¼çš„æ“ä½œéƒ½æœƒç”Ÿæˆæ–°å€¼ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸå€¼ã€‚
* æŒ‰å€¼å‚³éï¼šç•¶å°‡åŸå§‹å‹åˆ¥è³¦å€¼æˆ–å‚³éçµ¦è®Šæ•¸æ™‚ï¼Œæ˜¯ä»¥å€¼çš„æ–¹å¼å‚³éï¼Œä¹Ÿå°±æ˜¯èªªå®ƒå€‘ä¹‹é–“äº’ç›¸ç¨ç«‹ã€‚

=== ç¯„ä¾‹
[source, javascript]
----
let numA = 10;
let numB = numA;  // numB æ˜¯ numA çš„è¤‡è£½
numA = 20;
console.log(numB);  // è¼¸å‡º 10
----
åœ¨é€™è£¡ï¼ŒnumA çš„ä¿®æ”¹ä¸æœƒå½±éŸ¿ numBï¼Œå› ç‚ºå®ƒå€‘å„è‡ªå­˜å„²äº†è‡ªå·±çš„å€¼ã€‚

=== æ›´å¤šåŸå§‹å‹åˆ¥ç¯„ä¾‹
[source, javascript]
----
// string ç¯„ä¾‹
let greeting = "Hello, world!";
let anotherGreeting = greeting;
greeting = "Hi!";
console.log(anotherGreeting);  // "Hello, world!"

// number ç¯„ä¾‹
let num = 10;
let anotherNum = num;
num = 20;
console.log(anotherNum);  // 10

// boolean ç¯„ä¾‹
let isTrue = true;
let anotherBool = isTrue;
isTrue = false;
console.log(anotherBool);  // true

// bigint ç¯„ä¾‹
let bigIntNum = 9007199254740991n;
let anotherBigInt = bigIntNum;
bigIntNum = bigIntNum + 1n;
console.log(anotherBigInt);  // 9007199254740991n

// symbol ç¯„ä¾‹
let sym = Symbol("unique");
let anotherSym = sym;
console.log(sym === anotherSym);  // true
----

== 2. ç‰©ä»¶å‹åˆ¥ï¼ˆObject Typesï¼‰
ç‰©ä»¶å‹åˆ¥æ˜¯ç”±éµå€¼å°çµ„æˆçš„å¯è®Šé›†åˆã€‚æ‰€æœ‰éåŸå§‹å‹åˆ¥çš„æ•¸æ“šéƒ½æ˜¯ç‰©ä»¶å‹åˆ¥ï¼ŒåŒ…æ‹¬é™£åˆ—ã€å‡½æ•¸ã€æ—¥æœŸç­‰ã€‚

=== å¸¸è¦‹çš„ç‰©ä»¶å‹åˆ¥
* *ç‰©ä»¶ï¼ˆObjectï¼‰*ï¼šåŒ…å«éµå€¼å°ï¼Œä¾‹å¦‚ `{ name: "John", age: 30 }`
* *é™£åˆ—ï¼ˆArrayï¼‰*ï¼šä¸€ç¨®ç‰¹æ®Šçš„ç‰©ä»¶ï¼Œç”¨ä¾†å­˜å„²æœ‰åºçš„æ•¸æ“šåˆ—è¡¨ï¼Œä¾‹å¦‚ `[1, 2, 3]`
* *å‡½æ•¸ï¼ˆFunctionï¼‰*ï¼šä¹Ÿæ˜¯ç‰©ä»¶é¡å‹ï¼Œå¯ä»¥ä½œç‚ºä¸€ç­‰å…¬æ°‘é€²è¡Œæ“ä½œï¼Œä¾‹å¦‚ `function add(a, b) { return a + b; }`
* *æ—¥æœŸï¼ˆDateï¼‰*ï¼šè¡¨ç¤ºæ—¥æœŸå’Œæ™‚é–“çš„ç‰©ä»¶é¡å‹ï¼Œä¾‹å¦‚ `new Date()`
* *æ­£å‰‡è¡¨é”å¼ï¼ˆRegExpï¼‰*ï¼šè¡¨ç¤ºæ­£å‰‡è¡¨é”å¼çš„ç‰©ä»¶é¡å‹ï¼Œä¾‹å¦‚ `/abc/`

==== è£œå……èªªæ˜
* *ç¨€ç–é™£åˆ—ï¼ˆSparse Arrayï¼‰*ï¼šæŒ‡é™£åˆ—ä¸­å­˜åœ¨ç©ºæ´æˆ–æœªå®šç¾©çš„å…ƒç´ ã€‚
[source, javascript]
----
let sparseArr = [1, , 3];
console.log(sparseArr.length);  // 3
console.log(sparseArr[1]);  // undefined
----
* *éµå€¼çš„å¼·åˆ¶è½‰å‹*ï¼šé™£åˆ—çš„ç´¢å¼•å¯¦éš›ä¸Šæ˜¯ç‰©ä»¶çš„éµï¼Œæœƒè‡ªå‹•è½‰å‹ç‚ºå­—ä¸²ã€‚
[source, javascript]
----
let arr1 = [];
arr1[1] = 'a';
arr1['1'] = 'b';
console.log(arr1[1]);  // 'b'
----
* *å­—ä¸²çš„é¡é™£åˆ—è™•ç†èˆ‡æ¯”è¼ƒä¸åŒè³‡æ–™å‹æ…‹çš„å„²å­˜æ–¹å¼*ï¼šå­—ä¸²ä½œç‚ºé¡é™£åˆ—ï¼Œå­—ä¸²èˆ‡æ•¸å­—é€²è¡Œæ¯”è¼ƒæ™‚æœƒè‡ªå‹•é€²è¡Œé¡å‹è½‰æ›ã€‚
[source, javascript]
----
console.log('5' == 5);  // trueï¼Œå› ç‚º '5' è¢«è½‰å‹ç‚ºæ•¸å­— 5
console.log('5' === 5);  // falseï¼Œå› ç‚ºé€™è£¡é¡å‹ä¸ç›¸åŒ
----
* *éå¸¸å¤§èˆ‡éå¸¸å°çš„æ•¸å­—*ï¼šJavaScript ä¸­ä½¿ç”¨ BigInt è™•ç†éå¸¸å¤§çš„æ•´æ•¸ï¼Œæµ®é»æ•¸å‰‡éœ€æ³¨æ„é‹ç®—ç²¾åº¦å•é¡Œã€‚
[source, javascript]
----
const a = 1e20; // 1e20 çš„æ•¸å€¼
const b = a * 100; // b ç‚º 1e+22
const c = a / 0.001; // c ç‚º 1e+23

console.log(a); // 100000000000000000000
console.log(b); // 1e+22
console.log(c); // 1e+23

console.log(a.toExponential()); // "1e+20"
----

=== ç‰¹é»
* å¯è®Šæ€§ï¼šç‰©ä»¶å‹åˆ¥çš„å€¼æ˜¯å¯è®Šçš„ï¼Œå¯ä»¥åœ¨åŸä¾†çš„åŸºç¤ä¸Šä¿®æ”¹æˆ–æ“´å±•ã€‚
* æŒ‰å¼•ç”¨å‚³éï¼šç‰©ä»¶å‹åˆ¥æ˜¯æŒ‰å¼•ç”¨å‚³éçš„ï¼Œé€™æ„å‘³è‘—å¦‚æœå¤šå€‹è®Šæ•¸å¼•ç”¨åŒä¸€å€‹ç‰©ä»¶ï¼Œå°å…¶ä¸­ä¸€å€‹è®Šæ•¸æ‰€ä½œçš„æ”¹è®Šæœƒå½±éŸ¿åˆ°æ‰€æœ‰å¼•ç”¨è©²ç‰©ä»¶çš„è®Šæ•¸ã€‚

=== ç¯„ä¾‹
[source, javascript]
----
// ç‰©ä»¶ç¯„ä¾‹
let person = { name: "Alice", age: 25 };
let anotherPerson = person;
person.name = "Bob";
console.log(anotherPerson.name);  // "Bob"
// åœ¨é€™è£¡ï¼Œobj1 å’Œ obj2 éƒ½å¼•ç”¨äº†åŒä¸€å€‹ç‰©ä»¶ï¼Œå› æ­¤å° obj1 æ‰€åšçš„ä¿®æ”¹æœƒå½±éŸ¿ obj2ã€‚

// é™£åˆ—ç¯„ä¾‹
let arr = [1, 2, 3];
let anotherArr = arr;
arr.push(4);
console.log(anotherArr);  // [1, 2, 3, 4]

// å‡½æ•¸ç¯„ä¾‹
function greet() {
  return "Hello!";
}
let anotherGreet = greet;
console.log(anotherGreet());  // "Hello!"

// æ—¥æœŸç¯„ä¾‹
let now = new Date();
let anotherDate = now;
now.setFullYear(2025);
console.log(anotherDate.getFullYear());  // 2025

// æ­£å‰‡è¡¨é”å¼ç¯„ä¾‹
let regex = /abc/;
let anotherRegex = regex;
console.log(anotherRegex === regex);  // true
----

== 3. åŸå§‹å‹åˆ¥èˆ‡ç‰©ä»¶å‹åˆ¥çš„å·®ç•°
[cols="3,1,1"]
|===
| ç‰¹æ€§ | åŸå§‹å‹åˆ¥ï¼ˆPrimitive Typesï¼‰ | ç‰©ä»¶å‹åˆ¥ï¼ˆObject Typesï¼‰

| *å¯è®Šæ€§* | ä¸å¯è®Šï¼Œæ¯æ¬¡æ“ä½œéƒ½è¿”å›æ–°å€¼ | å¯è®Šï¼Œå¯ä»¥ç›´æ¥ä¿®æ”¹å±¬æ€§å’Œæ–¹æ³•
| *æ¯”è¼ƒæ–¹å¼* | æ¯”è¼ƒå€¼æœ¬èº«ï¼ˆæŒ‰å€¼æ¯”è¼ƒï¼‰ | æ¯”è¼ƒå¼•ç”¨ï¼ˆæŒ‰å¼•ç”¨æ¯”è¼ƒï¼‰
| *å­˜å„²æ–¹å¼* | ç›´æ¥å­˜å„²å…¶å€¼ | å­˜å„²çš„æ˜¯å°è±¡çš„å¼•ç”¨åœ°å€ï¼ˆæŒ‡å‘å…§å­˜ä½ç½®ï¼‰
| *å‚³éæ–¹å¼* | æŒ‰å€¼å‚³éï¼Œæ¯å€‹è®Šæ•¸äº’ç›¸ç¨ç«‹ | æŒ‰å¼•ç”¨å‚³éï¼Œè®Šæ•¸é–“å…±äº«å°è±¡
| *é¡å‹æ•¸é‡* | 7 ç¨®ï¼š`string`, `number`, `boolean`, `bigint`, `undefined`, `null`, `symbol` | ç„¡é™æ•¸é‡ï¼ŒåŒ…å« `Object`ã€`Array`ã€`Function` ç­‰
|===

=== ç¯„ä¾‹
[source, javascript]
----
// æŒ‰å€¼æ¯”è¼ƒ vs æŒ‰å¼•ç”¨æ¯”è¼ƒ
let str1 = "hello";
let str2 = "hello";
console.log(str1 === str2);  // true

let obj1 = { name: "John" };
let obj2 = { name: "John" };
console.log(obj1 === obj2);  // false

// æŒ‰å€¼å‚³é vs æŒ‰å¼•ç”¨å‚³é
let primitiveVal = 10;
function modifyPrimitive(val) {
  val = 20;
}
modifyPrimitive(primitiveVal);
console.log(primitiveVal);  // 10

let objVal = { value: 10 };
function modifyObject(val) {
  val.value = 20;
}
modifyObject(objVal);
console.log(objVal.value);  // 20
----

== 4. ç¸½çµ
* *åŸå§‹å‹åˆ¥*ï¼šæ˜¯ç°¡å–®ä¸”ä¸å¯è®Šçš„æ•¸æ“šé¡å‹ï¼Œé©åˆè¡¨ç¤ºåŸºç¤æ•¸æ“šã€‚
* *ç‰©ä»¶å‹åˆ¥*ï¼šéˆæ´»ä¸”å¯è®Šï¼Œé©åˆå­˜å„²å’Œæ“ä½œè¤‡é›œçš„æ•¸æ“šçµæ§‹ã€‚


== é¡¯æ€§è½‰æ›/éš±æ€§è½‰æ›

åœ¨ JavaScript ä¸­ï¼Œ*é¡¯æ€§è½‰æ›ï¼ˆExplicit Conversionï¼‰*å’Œ*éš±æ€§è½‰æ›ï¼ˆImplicit Conversionï¼‰*æŒ‡çš„æ˜¯å°‡ä¸€ç¨®è³‡æ–™é¡å‹è½‰æ›ç‚ºå¦ä¸€ç¨®çš„éç¨‹ã€‚é€™å…©ç¨®è½‰æ›çš„å€åˆ¥åœ¨æ–¼è½‰æ›æ˜¯å¦æ˜¯ç”±é–‹ç™¼è€…ä¸»å‹•é€²è¡Œï¼Œæˆ–è€…æ˜¯ç”± JavaScript å¼•æ“è‡ªå‹•é€²è¡Œã€‚

=== é¡¯æ€§è½‰æ›ï¼ˆExplicit Conversionï¼‰

é¡¯æ€§è½‰æ›æ˜¯æŒ‡é–‹ç™¼è€…*ä¸»å‹•*ä½¿ç”¨å…§å»ºæ–¹æ³•æˆ–é‹ç®—ç¬¦ä¾†å°‡ä¸€ç¨®é¡å‹è½‰æ›ç‚ºå¦ä¸€ç¨®é¡å‹ã€‚é€™æ˜¯ä¸€å€‹æ¸…æ™°ã€å¯æ§çš„éç¨‹ï¼Œé–‹ç™¼è€…ç¢ºåˆ‡åœ°çŸ¥é“ä½•æ™‚é€²è¡Œè½‰æ›ã€‚

==== å¸¸è¦‹çš„é¡¯æ€§è½‰æ›æ–¹æ³•

===== è½‰æ›ç‚ºæ•¸å­—

* ä½¿ç”¨ `Number()` å‡½æ•¸æˆ– `parseInt()`ã€`parseFloat()` æ–¹æ³•å°‡å…¶ä»–é¡å‹çš„æ•¸æ“šè½‰æ›ç‚ºæ•¸å­—ã€‚

[source,javascript]
----
console.log(Number('123'));            // 123
console.log(Number('-123.239'));       // -123.239
console.log(Number('123abc'));         // NaN
console.log(Number(undefined));        // NaN
console.log(Number(true));             // 1
console.log(Number(false));            // 0
console.log(Number(null));             // 0
console.log(Number('1e+5'));           // 100000
console.log(Number('  '));             // 0 (whitespace is trimmed)
console.log(Number('Infinity'));       // Infinity
console.log(Number('0xF'));            // 15 (Hexadecimal conversion)
----

`Number()` çš„ç›®æ¨™æ˜¯åˆ¤æ–·å€¼æ˜¯å¦åƒæ•¸å­—ï¼Œå¦‚æœåƒæ•¸å­—å‰‡è½‰æ›æˆåŠŸï¼Œå¦å‰‡ç‚º NaNã€‚ä¾‹å¦‚ true, false, null åˆ†åˆ¥ç‚º 1, 0, 0ã€‚

é‚Šç•Œæƒ…æ³ï¼šundefined æœƒè½‰æ›ç‚º NaNï¼Œç©ºå­—ä¸²æˆ–ç©ºç™½å­—ç¬¦æœƒè½‰æ›ç‚º 0ï¼Œåå…­é€²åˆ¶å­—ä¸²æœƒè½‰æ›ç‚ºå°æ‡‰çš„æ•¸å€¼ã€‚

===== `parseInt()` å’Œ `parseFloat()`

* `parseInt()` æœƒå°‡å€¼è½‰æ›æˆæ•´æ•¸ï¼Œè€Œ `parseFloat()` ä¿ç•™å°æ•¸ã€‚

[source,javascript]
----
console.log(parseInt('123.2'));        // 123
console.log(parseInt('123abc'));       // 123
console.log(parseInt('a'));            // NaN
console.log(parseFloat('123.239abc')); // 123.239
console.log(parseInt('100px'));        // 100
console.log(parseInt('10', 16));       // 16 (interprets as hexadecimal)
----

ğŸ’¡ `parseInt()` å¾ç¬¬ä¸€ä½é–‹å§‹åˆ¤æ–·ï¼Œé‡åˆ°éæ•¸å­—ä½å°±åœæ­¢ï¼›è€Œ `parseFloat()` æœƒä¿ç•™å°æ•¸ã€‚

é‚Šç•Œæƒ…æ³ï¼šå¯ä»¥å‚³å…¥é€²åˆ¶åƒæ•¸çµ¦ `parseInt()`ï¼Œéæ•¸å­—å­—ç¬¦æœƒå°è‡´åœæ­¢è½‰æ›ã€‚

===== è½‰æ›ç‚ºå­—ä¸²

* ä½¿ç”¨ `String()` å‡½æ•¸æˆ– `toString()` æ–¹æ³•å°‡å…¶ä»–é¡å‹çš„æ•¸æ“šè½‰æ›ç‚ºå­—ä¸²ã€‚

[source,javascript]
----
console.log(String(-123));             // "-123"
console.log(String(true));             // "true"
console.log((123).toString());         // "123"
console.log(String([1, 2, 3]));        // "1,2,3"
console.log(String({}));               // "[object Object]"
console.log(String(undefined));        // "undefined"
console.log(String(null));             // "null"
----

`undefined` å’Œ `null` ä¸èƒ½ä½¿ç”¨ `toString()`ã€‚ç‰©ä»¶æœƒè¿”å› "[object Object]"ï¼Œé™¤éå®šç¾©äº†è‡ªè¨‚çš„ `toString()` æ–¹æ³•ã€‚

===== è½‰æ›ç‚ºå¸ƒæ—å€¼

* ä½¿ç”¨ `Boolean()` å‡½æ•¸ä¾†å°‡å…¶ä»–é¡å‹è½‰æ›ç‚ºå¸ƒæ—å€¼ã€‚

[source,javascript]
----
console.log(Boolean(0));               // false
console.log(Boolean(''));              // false
console.log(Boolean('hello'));         // true
console.log(Boolean(undefined));       // false
console.log(Boolean([]));              // true
console.log(Boolean({}));              // true
----

é™¤äº† `0`, `""`, `undefined`, `null`, `NaN`ï¼Œå…¶é¤˜å€¼çš†ç‚º `true`ã€‚

é‚Šç•Œæƒ…æ³ï¼šç©ºé™£åˆ—å’Œç©ºç‰©ä»¶ä¹Ÿæ˜¯ `true`ã€‚

=== éš±æ€§è½‰æ›ï¼ˆImplicit Conversionï¼‰

éš±æ€§è½‰æ›æ˜¯æŒ‡ JavaScript åœ¨é€²è¡ŒæŸäº›é‹ç®—æˆ–æ“ä½œæ™‚*è‡ªå‹•*å°‡ä¸€ç¨®è³‡æ–™é¡å‹è½‰æ›ç‚ºå¦ä¸€ç¨®ï¼Œé€™é€šå¸¸ç™¼ç”Ÿåœ¨é‹ç®—ç¬¦è™•ç†ä¸åŒé¡å‹çš„æ•¸æ“šæ™‚ã€‚

==== å¸¸è¦‹çš„éš±æ€§è½‰æ›æƒ…æ³

* *å­—ä¸²èˆ‡å…¶ä»–é¡å‹çš„ç›¸åŠ *ï¼šç•¶å­—ä¸²èˆ‡æ•¸å­—æˆ–å…¶ä»–é¡å‹ç›¸åŠ æ™‚ï¼ŒJavaScript æœƒå°‡å…¶ä»–é¡å‹è½‰æ›ç‚ºå­—ä¸²é€²è¡Œæ‹¼æ¥ã€‚

[source,javascript]
----
let result = "The answer is " + 42;   // "The answer is 42"
let result2 = [1, 2, 3] + "";          // "1,2,3"
console.log([] + {});                  // "[object Object]"
console.log({} + []);                  // 0
----

* *æ•¸å­—é‹ç®—ä¸­çš„å¸ƒæ—å€¼*ï¼šå¸ƒæ—å€¼æœƒè¢«è½‰æ›ç‚ºæ•¸å­—ï¼š`true` è½‰æ›ç‚º 1ï¼Œ`false` è½‰æ›ç‚º 0ã€‚

[source,javascript]
----
let sum = true + 2;                    // 3
let difference = false - 1;            // -1
----

* *isNaN() å‡½æ•¸*ï¼š`isNaN()` ç”¨ä¾†åˆ¤æ–·å€¼æ˜¯å¦ç‚ºã€ŒNaNã€ã€‚å®ƒæœƒéš±å¼èª¿ç”¨ `Number()` ä¾†é€²è¡Œåˆ¤æ–·ã€‚

[source,javascript]
----
console.log(isNaN("abc"));            // true
console.log(isNaN(undefined));         // true
console.log(isNaN("123"));            // false (implicitly converts to number)
----

* *åŠ æ³•é‹ç®—ç¬¦ï¼ˆ+ï¼‰*ï¼šç•¶ + è™•ç†å­—ä¸²å’Œå…¶ä»–é¡å‹æ™‚ï¼Œæœƒå°‡å…¶ä»–é¡å‹è½‰æ›ç‚ºå­—ä¸²é€²è¡Œæ‹¼æ¥ã€‚

[source,javascript]
----
console.log('10' + 1);                 // "101"
console.log('10' - 1);                 // 9
----

* *ä¹˜æ³•èˆ‡é™¤æ³•é‹ç®—*ï¼šç•¶ä½¿ç”¨ä¹˜æ³•æˆ–é™¤æ³•é‹ç®—ç¬¦èˆ‡å­—ä¸²é€²è¡Œé‹ç®—æ™‚ï¼ŒJavaScript æœƒå˜—è©¦å°‡å­—ä¸²è½‰æ›ç‚ºæ•¸å­—ã€‚ç„¡æ³•è½‰æ›çš„å­—ä¸²æœƒè¿”å› NaNã€‚

[source,javascript]
----
console.log('6' * 2);                  // 12 (string '6' is converted to number 6)
console.log('10' / 2);                 // 5 (string '10' is converted to number 10)
console.log('abc' * 2);                // NaN (string 'abc' cannot be converted)
console.log('5.5' * 2);                // 11 (string '5.5' is converted to 5.5)
----

* *ç‰©ä»¶éš±å¼è½‰æ›*ï¼šç•¶ç‰©ä»¶èˆ‡åŸå§‹é¡å‹é€²è¡Œé‹ç®—æ™‚ï¼ŒJavaScript æœƒèª¿ç”¨ç‰©ä»¶çš„ `toString()` æˆ– `valueOf()` æ–¹æ³•é€²è¡Œéš±å¼è½‰æ›ã€‚

[source,javascript]
----
let obj = {
  valueOf() { return 10; }
};
console.log(obj + 1);                  // 11
----

=== éš±æ€§è½‰æ›çš„å¸¸è¦‹å•é¡Œ

éš±æ€§è½‰æ›æœ‰æ™‚æœƒå°è‡´æ„å¤–çš„è¡Œç‚ºï¼Œç‰¹åˆ¥æ˜¯åœ¨æ¯”è¼ƒå’Œé‹ç®—æ™‚ã€‚ä¾‹å¦‚ï¼š

* + å’Œ - çš„ä¸åŒè™•ç†ï¼š`+` ç”¨æ–¼å­—ä¸²æ‹¼æ¥ï¼Œè€Œ `-` æœƒé€²è¡Œæ•¸å­—è½‰æ›ã€‚

[source,javascript]
----
let result = "10" + 1;                // "101"
let result2 = "10" - 1;               // 9
----

* *BigInt å’Œ Symbol*ï¼šBigInt ä¸èƒ½èˆ‡å…¶ä»–åŸå§‹é¡å‹æ··åˆé‹ç®—ï¼Œå¿…é ˆé¡¯æ€§è½‰æ›ã€‚Symbol ä¹Ÿç„¡æ³•èˆ‡å…¶ä»–é¡å‹é€²è¡Œé‹ç®—ã€‚

[source,javascript]
----
console.log(1 + 1n);                  // Uncaught TypeError: Cannot mix BigInt and other types
console.log(1 + Symbol("1"));        // Uncaught TypeError: Cannot convert a Symbol value to a number
----

* *NaN çš„è™•ç†*ï¼šä»»ä½•èˆ‡ NaN é€²è¡Œçš„é‹ç®—éƒ½æœƒè¿”å› NaNã€‚

[source,javascript]
----
console.log(NaN + 5);                 // NaN
console.log("abc" - 1);              // NaN
----
=== é¡¯æ€§è½‰æ› vs éš±æ€§è½‰æ›

[cols="1,1,1", options="header"]
|===
| ç‰¹é» | é¡¯æ€§è½‰æ› | éš±æ€§è½‰æ›

| èª°ç™¼èµ·è½‰æ›
| é–‹ç™¼è€…æ˜ç¢ºé€²è¡Œ
| JavaScript å¼•æ“è‡ªå‹•é€²è¡Œ

| è½‰æ›çš„æ§åˆ¶
| å®Œå…¨æ§åˆ¶
| ç„¡æ³•æ§åˆ¶ï¼Œå–æ±ºæ–¼ä¸Šä¸‹æ–‡

| è½‰æ›æ–¹å¼
| ä½¿ç”¨æ˜ç¢ºçš„æ–¹æ³•å¦‚ `Number()`, `String()`
| ç™¼ç”Ÿæ–¼é‹ç®—ç¬¦ã€æ¯”è¼ƒã€æ¢ä»¶é‹ç®—æ™‚

| ç¤ºä¾‹
| `Number('123')` æ˜ç¢ºå°‡å­—ä¸²è½‰æ•¸å­—
| `'123' - 1` è‡ªå‹•å°‡å­—ä¸²è½‰æ›ç‚ºæ•¸å­—

| æ½›åœ¨å•é¡Œ
| å¯é æœŸï¼Œæ˜“æ–¼èª¿è©¦
| éš±å¼è½‰æ›æœ‰æ™‚æœƒå°è‡´æ„å¤–çš„çµæœï¼Œå¦‚å­—ä¸²æ‹¼æ¥æˆ–å¸ƒæ—è½‰æ›

| æ€§èƒ½
| è½‰æ›æœ‰å…·é«”æ­¥é©Ÿï¼Œç•¥å¾®å¢åŠ è¨ˆç®—è² æ“”
| ä¾è³´ JavaScript å¼•æ“è™•ç†ï¼Œé€šå¸¸è¼ƒå¿«ä½†é›£ä»¥é æ–™
|===


== å‹åˆ¥æ¯”è¼ƒ

åœ¨ JavaScript ä¸­ï¼Œå‹åˆ¥æ¯”è¼ƒï¼ˆtype comparisonï¼‰æ˜¯ç¶“å¸¸é‡åˆ°çš„å•é¡Œï¼Œå› ç‚º JavaScript æ˜¯å‹•æ…‹å‹åˆ¥èªè¨€ï¼Œå› æ­¤è®Šæ•¸çš„å‹åˆ¥å¯ä»¥åœ¨é‹è¡Œæ™‚æœŸæ”¹è®Šã€‚JavaScript æä¾›äº†å…©ç¨®ä¸»è¦çš„æ¯”è¼ƒé‹ç®—ç¬¦ï¼š

=== 1. å¯¬é¬†æ¯”è¼ƒï¼ˆLoose Equalityï¼‰ï¼š==

ä½¿ç”¨ == é€²è¡Œæ¯”è¼ƒæ™‚ï¼ŒJavaScript æœƒå˜—è©¦åœ¨æ¯”è¼ƒå‰é€²è¡Œé¡å‹è½‰æ›ï¼Œé€™æ„å‘³è‘—å³ä½¿è®Šæ•¸çš„é¡å‹ä¸åŒï¼Œä¹Ÿå¯èƒ½è¿”å› trueã€‚

[source,js]
----
console.log(5 == '5');  // true
console.log(0 == false); // true
console.log(null == undefined); // true
----

==== è¦å‰‡ï¼š
* JavaScript æœƒè‡ªå‹•å°‡ä¸åŒé¡å‹çš„æ•¸æ“šè½‰æ›ç‚ºç›¸åŒé¡å‹å†é€²è¡Œæ¯”è¼ƒã€‚
* å­—ç¬¦ä¸²å’Œæ•¸å­—æœƒè½‰æ›ç‚ºæ•¸å­—æ¯”è¼ƒã€‚
* null å’Œ undefined è¢«è¦–ç‚ºç›¸ç­‰ã€‚
* false æœƒè¢«è½‰æ›ç‚º 0ï¼Œtrue æœƒè¢«è½‰æ›ç‚º 1ã€‚

å•é¡Œï¼š
* ç”±æ–¼è‡ªå‹•å‹åˆ¥è½‰æ›ï¼Œé€™ç¨®æ¯”è¼ƒæœ‰æ™‚æœƒå°è‡´æ„æƒ³ä¸åˆ°çš„çµæœã€‚å› æ­¤ï¼Œé€šå¸¸ä¸æ¨è–¦ä½¿ç”¨ã€‚

=== 2. åš´æ ¼æ¯”è¼ƒï¼ˆStrict Equalityï¼‰ï¼š===

ä½¿ç”¨ === é€²è¡Œæ¯”è¼ƒæ™‚ï¼ŒJavaScript æœƒä¸é€²è¡Œé¡å‹è½‰æ›ï¼Œé€™æ„å‘³è‘—è®Šæ•¸çš„é¡å‹å’Œå€¼å¿…é ˆå®Œå…¨ç›¸åŒæ‰èƒ½è¿”å› trueã€‚

[source,js]
----
console.log(5 === '5');  // false
console.log(0 === false); // false
console.log(null === undefined); // false
----

==== è¦å‰‡ï¼š
* å¦‚æœå…©å€‹å€¼çš„é¡å‹ä¸åŒï¼Œç›´æ¥è¿”å› falseã€‚
* å¿…é ˆåœ¨é¡å‹å’Œå€¼éƒ½ç›¸ç­‰çš„æƒ…æ³ä¸‹ï¼Œæ‰æœƒè¿”å› trueã€‚

==== å„ªé»ï¼š
* é¿å…è‡ªå‹•å‹åˆ¥è½‰æ›çš„æ··æ·†ã€‚
* æ›´åŠ æ˜ç¢ºå’Œå¯é æ¸¬ï¼Œé©åˆå¤§å¤šæ•¸æ¯”è¼ƒæƒ…å¢ƒã€‚

=== 3. å…¶ä»–æ¯”è¼ƒæ–¹æ³•

Object.is() ç”¨æ–¼æ¯”è¼ƒå…©å€‹å€¼æ˜¯å¦ç›¸åŒï¼Œèˆ‡ === å¤§è‡´ç›¸åŒï¼Œä½†è™•ç†ä¸€äº›ç‰¹æ®Šå€¼ï¼ˆå¦‚ NaN å’Œ -0ï¼‰çš„æ–¹å¼ä¸åŒã€‚

[source,js]
----
console.log(Object.is(NaN, NaN));      // true
console.log(NaN === NaN);              // false
console.log(Object.is(+0, -0));         // false
----

=== 4. ä½¿ç”¨å ´æ™¯
* === åš´æ ¼æ¯”è¼ƒï¼šåœ¨å¤§å¤šæ•¸æƒ…æ³ä¸‹ï¼Œæ‡‰è©²ä½¿ç”¨ ===ï¼Œå› ç‚ºå®ƒæ›´åŠ å®‰å…¨å’Œæ¸…æ™°ã€‚
* == å¯¬é¬†æ¯”è¼ƒï¼šç•¶ä½ ç¢ºå¯¦éœ€è¦é€²è¡Œä¸åŒé¡å‹ä¹‹é–“çš„æ¯”è¼ƒï¼Œä¸¦ä¸”å¸Œæœ› JavaScript è‡ªå‹•é€²è¡Œé¡å‹è½‰æ›æ™‚ï¼Œæ‰è€ƒæ…®ä½¿ç”¨ã€‚

=== å¸¸è¦‹é™·é˜±

null å’Œ undefined åœ¨ == ä¸‹ç›¸ç­‰ï¼Œä½†åœ¨ === ä¸‹ä¸ç›¸ç­‰ã€‚  
NaN èˆ‡ä»»ä½•å€¼éƒ½ä¸ç›¸ç­‰ï¼ŒåŒ…æ‹¬å®ƒè‡ªå·±ï¼Œæ‰€ä»¥æ¯”è¼ƒ NaN å€¼æ™‚æ‡‰ä½¿ç”¨ isNaN() æˆ– Object.is()ã€‚

=== 5. å„ç¨®å‹åˆ¥æ¯”è¼ƒç¯„ä¾‹

==== é™£åˆ—
[source,js]
----
let arr1 = [1, 2, 3];
let arr2 = [1, 2, 3];
let arr3 = arr1;

console.log(arr1 == arr2);   // false ï¼ˆä¸åŒçš„ç‰©ä»¶å¼•ç”¨ï¼‰
console.log(arr1 === arr2);  // false ï¼ˆä¸åŒçš„ç‰©ä»¶å¼•ç”¨ï¼‰
console.log(arr1 === arr3);  // true  ï¼ˆå¼•ç”¨åŒä¸€å€‹ç‰©ä»¶ï¼‰

console.log([1, 2] == [1, 2]);   // false ï¼ˆä¸åŒçš„ç‰©ä»¶å¼•ç”¨ï¼‰
console.log([1, 2] === [1, 2]);  // false
----

==== ç‰©ä»¶
[source,js]
----
let obj1 = { a: 1 };
let obj2 = { a: 1 };
let obj3 = obj1;

console.log(obj1 == obj2);   // false ï¼ˆä¸åŒçš„ç‰©ä»¶å¼•ç”¨ï¼‰
console.log(obj1 === obj2);  // false ï¼ˆä¸åŒçš„ç‰©ä»¶å¼•ç”¨ï¼‰
console.log(obj1 === obj3);  // true  ï¼ˆå¼•ç”¨åŒä¸€å€‹ç‰©ä»¶ï¼‰
----

==== Infinity å’Œ -Infinity
[source,js]
----
console.log(Infinity == Infinity);   // true
console.log(Infinity === Infinity);  // true
console.log(Infinity > 999999999);   // true

console.log(-Infinity == -Infinity); // true
console.log(-Infinity === -Infinity);// true
console.log(-Infinity < -999999999); // true
----

==== Symbol
[source,js]
----
let sym1 = Symbol('foo');
let sym2 = Symbol('foo');

console.log(sym1 == sym2);   // false ï¼ˆæ¯å€‹ Symbol éƒ½æ˜¯å”¯ä¸€çš„ï¼‰
console.log(sym1 === sym2);  // false
----

==== BigInt å’Œ Number
[source,js]
----
let bigInt1 = BigInt(1);
let num1 = 1;

console.log(bigInt1 == num1);    // true  ï¼ˆå¯¬é¬†æ¯”è¼ƒï¼Œæœƒå°‡ BigInt å’Œ Number è¦–ç‚ºç›¸ç­‰ï¼‰
console.log(bigInt1 === num1);   // false ï¼ˆåš´æ ¼æ¯”è¼ƒï¼Œä¸åŒå‹åˆ¥ï¼‰

console.log(1n === 1);  // false  ï¼ˆBigInt èˆ‡ Number åš´æ ¼æ¯”è¼ƒä¸åŒï¼‰
console.log(1n == 1);   // true   ï¼ˆBigInt èˆ‡ Number å¯¬é¬†æ¯”è¼ƒç›¸åŒï¼‰
----

=== 6. ç¸½çµ
* ä½¿ç”¨ === é€²è¡Œåš´æ ¼æ¯”è¼ƒå¯ä»¥é¿å… JavaScript è‡ªå‹•é€²è¡Œå‹åˆ¥è½‰æ›æ™‚å¸¶ä¾†çš„æ½›åœ¨éŒ¯èª¤ã€‚
* == å¯ä»¥ä¾ç…§æ¥­å‹™éœ€æ±‚ç‰¹æ€§ä½¿ç”¨ã€‚
* åœ¨è™•ç†ç‰©ä»¶ã€é™£åˆ—ç­‰è¤‡é›œå‹åˆ¥æ™‚ï¼Œå¿…é ˆæ³¨æ„å¼•ç”¨çš„ç›¸åŒèˆ‡å¦ï¼Œè€Œä¸åƒ…åƒ…æ˜¯å€¼çš„ç›¸åŒã€‚




































[[iife-èˆ‡-é«˜éšå‡½å¼]]
== IIFE èˆ‡ é«˜éšå‡½å¼

=== é«˜éšå‡½å¼

=== Immediately Invoked Function Expression, IIFE

==== è¡¨é”å¼ï¼ˆExpressionsï¼‰å’Œé™³è¿°å¥ï¼ˆStatementsï¼‰çš„å·®ç•°

åœ¨èªªæ˜IIFEä¹‹å‰ï¼Œè¦å…ˆèªªæ˜ä¸€ä¸‹ function statements å’Œ function
expressions é€™å…©ç¨®ä¸åŒå»ºç«‹å‡½å¼çš„æ–¹å¼


===== è¡¨é”å¼ ( Expressions )


Expressions æŒ‡çš„æ˜¯è¼¸å…¥å¾Œèƒ½å¤ ç›´æ¥å›å‚³å€¼çš„ä¸€ä¸²ç¨‹å¼ï¼ˆa unit of code
that results in a valueï¼‰ï¼Œ
ä¸€èˆ¬å¯èƒ½æœƒæŠŠå®ƒå­˜æˆä¸€å€‹è®Šæ•¸ï¼Œä½†æ˜¯å®ƒä¸ä¸€å®šè¦è¢«å­˜æˆä¸€å€‹è®Šæ•¸ã€‚
ç°¡å–®ä¾†èªªï¼Œåªè¦è¼¸å…¥çš„é‚£ä¸²ç¨‹å¼åŸ·è¡Œå¾Œèƒ½ç›´æ¥å›å‚³ä¸€å€‹å€¼ï¼Œé‚£éº¼å®ƒå°±æ˜¯å€‹
expressionã€‚ èˆ‰ä¾‹ä¾†èªªï¼Œåœ¨ç€è¦½å™¨çš„ console ä¸­è¼¸å…¥ a = 3
æ™‚ï¼Œå®ƒæœƒç›´æ¥å›å‚³ 3 é€™å€‹å€¼ï¼›è¼¸å…¥ 2 + 3 çš„æ™‚å€™ï¼Œ å®ƒæœƒç›´æ¥å›å‚³ 5ï¼›è¼¸å…¥
a = { }
çš„æ™‚å€™ï¼Œå®ƒæœƒå›å‚³ä¸€å€‹ç‚ºç‰©ä»¶çš„å€¼ã€‚é€™ç¨®è¼¸å…¥ä¸€æ®µç¨‹å¼å¾Œï¼Œæœƒç›´æ¥å–å¾—å›å‚³ä¸€å€‹å€¼çš„ç¨‹å¼å…§å®¹ï¼Œæˆ‘å€‘å°±ç¨±ç‚º
Expressionsã€‚


===== é™³è¿°å¥ ( Statements )

ä¸‹æ–¹æ˜¯å€‹é™³è¿°å¥çš„ç¯„ä¾‹

[source,javascript]
----

var a = 3;
if (a === 3) {
    console.log('Hello');
}
----



åœ¨é€™æ®µç¨‹å¼ä¸­ a === 3
æ˜¯ä¸€å€‹è¡¨é”å¼ï¼ˆexpressionï¼‰ï¼Œå› ç‚ºå®ƒå¯ä»¥ç›´æ¥å›å‚³å€¼ï¼ˆå³ï¼Œtrue æˆ–
falseï¼‰ï¼› è€Œ if é€™å€‹æŒ‡ä»¤ï¼Œå‰‡æ˜¯ä¸€å€‹
statementï¼Œå› ç‚ºå®ƒä¸æœƒç›´æ¥å›å‚³ä¸€å€‹å€¼ï¼Œæˆ‘å€‘ä¹Ÿä¸èƒ½å°‡å®ƒæŒ‡å®šç‚ºä¸€å€‹è®Šæ•¸ï¼š


[source,javascript]
----

// éŒ¯èª¤çš„å¯«æ³•
var a = 3;
const b = if (a === 3) {
    console.log('Hello');
}
----


ä½†æ”¹ç‚ºä¸‰å…ƒé‹ç®—å­å¯ä»¥ä½¿ç”¨

[source,javascript]
----

var a = 3;
const b = (a === 3) 
    ? console.log('Hello') 
    : null;
----



é€™æ˜¯å› ç‚ºä¸‰å…ƒé‹ç®—å­æ˜¯å±¬æ–¼è¡¨é”å¼çš„ä¸€ç¨®ï¼Œ
ä¸¦ä¸”ä¸€å®šæœƒæœ‰å›å‚³å€¼ï¼Œè€Œé™³è¿°å¥å‰‡ä¸ä¸€å®šã€‚


==== IIFE æ˜¯ä»€éº¼?

å¦‚åŒå­—é¢ä¸Šæ‰€æ•˜è¿°çš„ï¼ŒIIFE æŒ‡çš„å°±æ˜¯é€é function expression
çš„æ–¹å¼ä¾†å»ºç«‹å‡½å¼ï¼Œä¸¦ä¸”ç«‹å³åŸ·è¡Œå®ƒã€‚ èˆ‰ä¾‹ä¾†èªªï¼Œå¯ä»¥ç”¨ console.log
ä¾†çœ‹ä¸€ä¸‹å‰›å‰›å»ºç«‹çš„ iife1Print å‘¼å«å‡ºä¾†æœƒé•·ä»€éº¼æ¨£å­ã€‚


[source,javascript]
----

var iife1Print = function (user) {
    console.log('helloWorld, ' + user);
}
console.log(iife1Print);
----



çµæœæœƒç™¼ç¾ï¼ŒæŠŠ iife1Print
å‘¼å«å‡ºä¾†å¾Œï¼Œå®ƒæœƒç›´æ¥å›å‚³æ•´å€‹å‡½å¼çš„ç¨‹å¼ç¢¼å…§å®¹ï¼Œé€™æ˜¯å°šæœªåŸ·è¡Œç¨‹å¼ç¢¼å‰çš„çµæœã€‚



å¦‚æœæ˜¯ IIFE å°±åœ¨é€™æ®µç¨‹å¼ç¢¼çš„æœ€å¾Œï¼ŒåŠ ä¸Šä¸€å€‹åŸ·è¡Œçš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æ‹¬è™Ÿ ()



[source,javascript]
----

var iife2ImmediatelyRun = function (name) {
    console.log('Welcome ' + name);
}();
console.log(iife2ImmediatelyRun);
----



åœ¨å»ºç«‹å‡½å¼çš„åŒæ™‚ï¼Œé€™æ®µå‡½å¼å°±æœƒç«‹å³è¢«åŸ·è¡Œï¼Œé€™è£¡é¢åŒæ¨£å¯ä»¥å¸¶å…¥åƒæ•¸


[source,javascript]
----

var iife3ImmediatelyRun= function (name) {
    console.log('Welcome ' + name);
}('Guest');
console.log(iife3ImmediatelyRun);
----



é€™æ¨£å°±æœƒç›´æ¥å¾—åˆ° "Welcome Guest" çš„çµæœï¼š è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ©ç”¨ IIFE
çš„å¯«æ³•å¾Œï¼ŒåŸæœ¬çš„è®Šæ•¸ iife4ImmediatelyRun
å·²ç¶“è®Šæˆå‡½å¼åŸ·è¡Œå¾Œå›å‚³çš„ã€Œå­—ä¸²ã€
ï¼Œå®ƒå·²ç¶“æ˜¯å­—ä¸²äº†ï¼Œæ‰€ä»¥æ²’è¾¦æ³•å†å»åŸ·è¡Œå®ƒï¼ å¦‚æœç¡¬è¦åœ¨å¾Œé¢ä½¿ç”¨
() åŸ·è¡Œçš„è©±ï¼Œå°±æœƒå ±éŒ¯


[source,javascript]
----

var iife4ImmediatelyRun = function(name) {
    return('Welcome ' + name);
}('Guest'); // ç«‹å³åŸ·è¡Œï¼Œä¸¦å›å‚³å­—ä¸²
console.log(iife4ImmediatelyRun()); // æ‰€ä»¥é€™é‚Šæœƒå ±éŒ¯
----



å†æŠŠ function è£¡é¢çš„ console.log æ”¹æˆ return

[source,javascript]
----

var iife5PrintCode = function(name) {
    return('Welcome ' + name);
};
console.log(iife5PrintCode);
----

é€™æ™‚å€™ï¼Œå¦‚æœä½¿ç”¨ console.log æŠŠ iife5PrintCode
é€™å€‹è®Šæ•¸é¡¯ç¤ºå‡ºä¾†çœ‹çš„è©±ï¼Œå¯ä»¥ç™¼ç¾å®ƒé‚„æ˜¯ä¸€å€‹å‡½å¼

==== æ›´æ·±å…¥çš„æ‡‰ç”¨ IIFE

é€™æ™‚å°±è¦å›ä¾†æ expression çš„æ¦‚å¿µï¼ŒExpressions
æŒ‡çš„æ˜¯è¼¸å…¥å¾Œèƒ½å¤ ç›´æ¥å›å‚³å€¼çš„ä¸€ä¸²ç¨‹å¼ï¼Œ
ä¸€èˆ¬å¯èƒ½æœƒæŠŠå®ƒå­˜æˆä¸€å€‹è®Šæ•¸ï¼Œä½†æ˜¯å®ƒä¸ä¸€å®šè¦è¢«å­˜æˆä¸€å€‹è®Šæ•¸ã€‚
æ¯”å¦‚å¯ä»¥ç›´æ¥åœ¨ç¨‹å¼ä¸­è¼¸å…¥ï¼Œæ•¸å€¼ã€å­—ä¸²ã€ç”šè‡³æ˜¯ç‰©ä»¶ï¼Œé€™æ™‚å€™å»åŸ·è¡Œç¨‹å¼çš„æ™‚å€™ï¼Œ
ç¨‹å¼å¯ä»¥æ­£ç¢ºåŸ·è¡Œï¼Œä¸” console è¦–çª—ä¸¦ä¸æœƒæœ‰ä»»ä½•å…§å®¹ï¼š

[source,javascript]
----

// Expression
3;

'Guest';

{
    name: 'Guest'
}
----



å¦‚æœå¸Œæœ›çš„ function
ä¹Ÿå¯ä»¥ç”¨é€™ç¨®æ–¹å¼ä¾†åŸ·è¡Œï¼Œè€Œä¸ç”¨å»æŠŠå®ƒå»ºç«‹åœ¨ä»»ä½•è®Šæ•¸çš„è©±ã€‚
å¯èƒ½æœƒæƒ³é€™éº¼åšï¼š


[source,javascript]
----

// ä¸å¯è¡Œçš„åšæ³•
function(name) {
    return('Welcome, ' + name);
}
----


ä½†æ˜¯é€™éº¼åšæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ç‚º JavaScript å¼•æ“åœ¨è§£æç¨‹å¼ç¢¼çš„æ™‚å€™ï¼Œ
å› ç‚ºç”¨ function åšç‚ºé–‹é ­ï¼Œå®ƒæœƒèªç‚ºç¾åœ¨è¦è¼¸å…¥ function statementï¼Œ
å¯æ˜¯å»æ²’æœ‰çµ¦è©² function
çš„åç¨±ï¼Œæ–¼æ˜¯å®ƒç„¡æ³•æ­£ç¢ºç†è§£é€™æ®µç¨‹å¼ç¢¼ä¾¿æ‹‹å‡ºéŒ¯èª¤ï¼š



æ‰€ä»¥ï¼Œé€™æ™‚å€™è¦åšçš„æ˜¯å‘Šè¨´ JavaScript å¼•æ“èªªï¼Œé€™ä¸€æ•´å€‹ä¸¦ä¸æ˜¯
function statementã€‚
è¦é”åˆ°é€™æ¨£çš„ç›®çš„ï¼Œæˆ‘å€‘è¦è®“å¼•æ“åœ¨è§£æç¨‹å¼çš„æ™‚å€™ï¼Œä¸æ˜¯ä»¥è®€åˆ° function
åšç‚ºé–‹é ­ã€‚ ç‚ºäº†è¦é”åˆ°é€™æ¨£çš„ç›®çš„ï¼Œæˆ‘å€‘æœ€å¸¸ä½¿ç”¨çš„åšæ³•å°±æ˜¯ç”¨æ‹¬è™Ÿ () æŠŠ
function(){ ...} åŒ…èµ·ä¾†ï¼Œåƒæ˜¯é€™æ¨£ï¼š


[source,javascript]
----

(function(name) {
    return('Welcome, ' + name);
});
----



å› ç‚ºæˆ‘å€‘åªæœƒåœ¨æ‹¬å¼§å…§æ”¾å…¥ expressionï¼Œä¾‹å¦‚ (3+2)ï¼Œè€Œä¸æœƒæ”¾ statement
åœ¨æ‹¬å¼§å…§ï¼Œ æ‰€ä»¥JavaScript å°±æœƒä»¥ expression çš„æ–¹å¼ä¾†è®€å–é€™æ®µå‡½å¼ã€‚
åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œé€™å€‹ function
æœƒè¢«å»ºç«‹ï¼Œä½†æ˜¯ä¸æœƒè¢«å­˜åœ¨ä»»ä½•è®Šæ•¸ç•¶ä¸­ï¼Œä¹Ÿä¸æœƒè¢«åŸ·è¡Œã€‚ çµåˆå‰›å‰›ä¸Šé¢
IIFEs çš„æ¦‚å¿µï¼Œæˆ‘å€‘å¯ä»¥åœ¨å»ºç«‹é€™å€‹å‡½å¼çš„åŒæ™‚ï¼Œ
å°‡é€™å€‹å‡½å¼åŠ ä»¥åŸ·è¡Œï¼Œæˆ‘å€‘åŒæ¨£åªéœ€è¦åœ¨æœ€å¾ŒåŠ ä¸Šæ‹¬è™Ÿ () å°±å¯ä»¥äº†ï¼š


[source,javascript]
----

(function(name) {
    return('Welcome, ' + name);
})('Guest');
----



é€™æ¨£ IIFE çš„å‹å¼ï¼Œæœƒåœ¨è¨±å¤šçš„ JavaScript
æ¡†æ¶ä¸­éƒ½çœ‹å¾—åˆ°ï¼Œé€éé€™æ¨£çš„æ–¹å¼ï¼Œ
å¯ä»¥ã€Œç›´æ¥åŸ·è¡ŒæŸå€‹å‡½å¼ã€ï¼Œé‚„æœ‰å¾ˆé‡è¦çš„ä¸€é»æ˜¯ï¼Œ åœ¨ IIFE
å…§æ‰€å®šç¾©çš„è®Šæ•¸ä¸¦ä¸æœƒè·‘å‡ºå»é€™å€‹å‡½å¼ä¹‹å¤–è€Œå¹²æ“¾åˆ°ç¨‹å¼å…¶ä»–çš„éƒ¨åˆ†ï¼Œ
é™„å¸¶ä¸€æçš„æ˜¯ï¼Œå¦‚æœæƒ³è¦æŠŠç‰©ä»¶ä¹Ÿç›´æ¥ç”¨ expression ä¾†è¡¨ç¤ºçš„è©±ï¼Œ
åŒæ¨£ä¹Ÿå¯ä»¥ç”¨ ( ) ä¾†æŠŠç‰©ä»¶åŒ…èµ·ä¾†å°±å¯ä»¥äº†ã€‚

[source,javascript]
----

({
    name: 'Guest',
    interest: 'Website Developer'
})
----


é‚„æœ‰ä¸€ç¨®å¸¸è¦‹çš„æ–¹æ³•æ˜¯ä½¿ç”¨ ! æˆ– + æ”¾åœ¨ function() å‰ï¼Œé€™ä¹Ÿæ˜¯ä¸€ç¨®IIFEï¼Œ
æ•ˆæœèˆ‡()å®Œå…¨ä¸€æ¨£ã€‚

[source,javascript]
----

!function(){}()
+function(){}()
(function())()
//éƒ½æ˜¯IIFE
----

==== IIFE æœ€å¸¸è¦‹ä½¿ç”¨æƒ…å¢ƒ

===== å¥—ä»¶å°è£èˆ‡åƒæ•¸éš”é›¢

åœ¨ä»¥å‰æ™‚ï¼Œå› ç‚ºES6é‚„æ²’èª•ç”Ÿï¼Œæ‰€ä»¥ä¹Ÿæ²’æœ‰importçš„æ–¹æ³•å¯ä»¥ä½¿ç”¨ï¼Œ
æ‰€ä»¥å¤§å¤šçš„å¥—ä»¶åœ¨æ’°å¯«jsæª”å¼•å…¥æ™‚ï¼Œéƒ½æ˜¯ä½¿ç”¨IIFEçš„æ–¹æ³•ï¼Œè®“jsæª”è¢«å¼•å…¥çš„æ™‚å€™ï¼Œ
å°±ç«‹å³åŸ·è¡Œï¼Œä¸¦ä¸”æ“æœ‰ç¨ç«‹çš„åƒæ•¸å€å¡Šï¼Œé˜²æ­¢èˆ‡å¤–éƒ¨è¡çªï¼Œ
é€™ä¹Ÿæ˜¯ç‚ºä½•æˆ‘å€‘åœ¨htmlä¸­å¼•å…¥bootstrapã€jQueryç­‰å¥—ä»¶æ™‚ï¼Œ
ä¸ç”¨åŸ·è¡Œå°±å·²ç¶“ç”Ÿæ•ˆçš„åŸå› ã€‚

å¯ä»¥çœ‹çœ‹ä»¥ä¸‹å¥—ä»¶çš„ js æª”ç¨‹å¼ç¢¼ï¼Œéƒ½æœƒç™¼ç¾å¯é€éç¶²å€ç›´æ¥å¼•å…¥ä¸¦ä½¿ç”¨çš„å¥—ä»¶ï¼Œ
99%éƒ½æ˜¯ä½¿ç”¨IIFEçš„æ–¹å¼ã€‚

* https://code.jquery.com/jquery-3.7.1.min.js[jQuery]
* https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js[Google çš„ prettify] 
* https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js[bootstrap]
* https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js[bootstrap çš„ popper]


===== ç¨‹å¼ç¯„ä¾‹å½™æ•´
[source,javascript]
----

// Function Statement
function sayHello(name) {
    console.log('Hello ' + name);
}
sayHello('Guest');

// Function Expression;
var sayWelcome = function(name) {
    console.log('Welcome, ' + name);
};
sayWelcome('Guest');
console.log(sayWelcome);

// Immediately Invoked Functions Expressions (IIFEs)
var sayWelcomeIIFEs = (function(name) {
    return 'Welcome, ' + name;
})('Guest');

// Throw Error HERE!!
console.log(sayWelcomeIIFEs());

//Expression
(function(name) {
    console.log('Welcome, ' + name);
})('Guest');

({
    name: 'Guest',
    interest: 'web'
});
----

=== é«˜éšå‡½å¼ (Higher-Order Functions)

==== é«˜éšå‡½å¼æ˜¯ä»€éº¼ï¼Ÿ

é«˜éšå‡½å¼æ˜¯æŒ‡å¯ä»¥æ¥å—å¦ä¸€å€‹å‡½å¼ä½œç‚ºåƒæ•¸æˆ–è¿”å›ä¸€å€‹å‡½å¼ä½œç‚ºçµæœçš„å‡½å¼ã€‚é€™å€‹æ¦‚å¿µåœ¨å¤šç¨®ç¨‹å¼èªè¨€ä¸­éƒ½æ”¯æ´ï¼Œ
ä¾‹å¦‚ï¼šJavaScriptã€Pythonã€Swift ç­‰ã€‚é«˜éšå‡½å¼æœ‰åŠ©æ–¼æé«˜ç¨‹å¼ç¢¼çš„æ¨¡å¡ŠåŒ–èˆ‡å¯ç¶­è­·æ€§ï¼Œç‰¹åˆ¥æ˜¯åœ¨è™•ç†å¤šé‡è¿´åœˆé‚è¼¯çš„æ‹†è§£æ™‚ã€‚


==== é«˜éšå‡½å¼çš„æ‡‰ç”¨

*å›èª¿å‡½å¼ (Callback Functions)ï¼š* å¯ä»¥å°‡å›èª¿å‡½å¼ä½œç‚ºåƒæ•¸å‚³éï¼Œå¯¦ç¾è‡ªå®šç¾©è¡Œç‚ºã€‚

*æŠ½è±¡æ“ä½œï¼š* é«˜éšå‡½å¼èƒ½å°è£æ“ä½œï¼Œå¦‚éæ¿¾å’Œè½‰æ›ã€‚

*å‡½å¼çµ„åˆï¼š* é«˜éšå‡½å¼å¯çµ„åˆå¤šå€‹å‡½å¼ï¼Œå‰µå»ºæ–°çš„å‡½å¼ã€‚

==== é«˜éšå‡½å¼çš„ç¯„ä¾‹

*å¸¸è¦‹çš„é«˜éšå‡½å¼ï¼š*

.1. Array.prototype.mapï¼šå°é™£åˆ—æ¯å€‹å…ƒç´ æ“ä½œï¼Œè¿”å›æ–°é™£åˆ—ã€‚. 
[source,javascript]
----
const numArrayMap = [1, 2, 3, 4, 5];
const doubledNumbersMap = numArrayMap.map((num) => num * 2);
console.log(doubledNumbersMap); // [2, 4, 6, 8, 10]
----
.2. Array.prototype.filterï¼šéæ¿¾ç¬¦åˆæ¢ä»¶çš„å…ƒç´ ã€‚. 
[source,javascript]
----
const numArrayFilter = [1, 2, 3, 4, 5];
const evenNumbersFilter = numArrayFilter.filter((num) => num % 2 === 0);
console.log(evenNumbersFilter); // [2, 4]
----

å¦ä¸€ç¨®æ–¹å¼æ˜¯ç›´æ¥å°‡å‡½å¼ä½œç‚ºåƒæ•¸ï¼š
[source,javascript]
----
const numArrayFilter2 = [2, 4, 6, 8, 10];
const filteredNumbers = numArrayFilter2.filter(function (item) {
    return item % 5 === 0;
});
console.log(filteredNumbers); // [10]
----

.3. Array.prototype.reduceï¼šç´¯ç©é™£åˆ—å…ƒç´ ï¼Œè¿”å›å–®ä¸€çµæœã€‚. 
[source,javascript]
----
const numArrayReduce = [1, 2, 3, 4, 5];
const sumArrayReduce = numArrayReduce.reduce((total, num) => total + num, 0);
console.log(sumArrayReduce); // 15
----

.4. setTimeout / setIntervalï¼šå°‡å›èª¿å‡½å¼ä½œç‚ºåƒæ•¸ã€‚. 

ä½¿ç”¨ setTimeout æ–¹æ³•å°‡å›èª¿å‡½å¼ä½œç‚ºåƒæ•¸ï¼Œå»¶é²åŸ·è¡ŒæŒ‡å®šçš„å‡½å¼ï¼š
[source,javascript]
----
setTimeout(() => {
    console.log("é€™æ˜¯å»¶é²çš„è¨Šæ¯ setTimeout");
}, 1000);
----
å›å‚³çµæœï¼šé€™æ˜¯å»¶é²çš„è¨Šæ¯ setTimeout (å»¶é² 1 ç§’å¾Œè¼¸å‡º)

ä½¿ç”¨ setInterval æ–¹æ³•æ¯éš”æŒ‡å®šæ™‚é–“åŸ·è¡Œä¸€æ¬¡å›èª¿å‡½å¼ï¼š
[source,javascript]
----
let countInterval = 0;
const intervalIdCustom = setInterval(() => {
    countInterval += 1;
    console.log("é€™æ˜¯ç¬¬ " + countInterval + " æ¬¡åŸ·è¡Œ setInterval");
    if (countInterval === 5) {
        clearInterval(intervalIdCustom); // åœæ­¢ setInterval
    }
}, 1000);
----
å›å‚³çµæœï¼š

. 1 ç§’å¾Œè¼¸å‡ºï¼šé€™æ˜¯ç¬¬ 1 æ¬¡åŸ·è¡Œ setInterval. 
. 2 ç§’å¾Œè¼¸å‡ºï¼šé€™æ˜¯ç¬¬ 2 æ¬¡åŸ·è¡Œ setInterval. 
. 3 ..æŒçºŒåˆ°ç¬¬ 5 æ¬¡ï¼Œä¸¦åœæ­¢ã€‚ 


==== è‡ªè¡Œå¯¦ç¾é«˜éšå‡½å¼ï¼šmyCustomFilter
è‡ªå®šç¾©ä¸€å€‹ myCustomFilter å‡½å¼ï¼Œå¯¦ç¾èˆ‡ filter é¡ä¼¼çš„åŠŸèƒ½ï¼š

[source,javascript]
----
function myCustomFilter(callbackFn, arrayToFilter) {
    const filteredArrayResult = [];
    for (let i = 0; i < arrayToFilter.length; i++) {
        if (callbackFn(arrayToFilter[i])) {
            filteredArrayResult.push(arrayToFilter[i]);
        }
    }
    return filteredArrayResult;
}
const numArrayToFilter = [1, 2, 3, 4, 5];
const evenNumResult = myCustomFilter((item) => item % 2 === 0, numArrayToFilter);
console.log(evenNumResult); // [2, 4]
----

ä¸ä½¿ç”¨é«˜éšå‡½å¼æ™‚ï¼Œç¯„ä¾‹å¦‚ä¸‹ï¼š

[source,javascript]
----
function myBasicFilter(arrayToFilterBasic) {
    const filteredArrayBasic = [];
    for (let i = 0; i < arrayToFilterBasic.length; i++) {
        if (arrayToFilterBasic[i] % 2 === 0) {
            filteredArrayBasic.push(arrayToFilterBasic[i]);
        }
    }
    return filteredArrayBasic;
}
const numArrayToFilterBasic = [1, 2, 3, 4, 5];
const evenNumResultBasic = myBasicFilter(numArrayToFilterBasic);
console.log(evenNumResultBasic); // [2, 4]
----

æœªä½¿ç”¨é«˜éšå‡½å¼æ™‚ï¼Œé‚è¼¯è¼ƒç‚ºæ··äº‚ï¼Œä¸”éœ€è¦é‡è¤‡ç·¨å¯«ç¯©é¸æ¢ä»¶çš„å‡½å¼ï¼Œé€™æœƒå¢åŠ ä»£ç¢¼çš„å†—é¤˜å’Œç¶­è­·æˆæœ¬ã€‚

==== è£œå……ï¼šä¸€ç´šå‡½å¼ (First-class Functions) æ˜¯ä»€éº¼ï¼Ÿ

ä¸€ç´šå‡½å¼æŒ‡å‡½å¼å¯ä»¥åƒè®Šæ•¸ä¸€æ¨£è¢«å‚³éã€è³¦å€¼æˆ–ä½œç‚ºè¿”å›å€¼ã€‚é€™ä½¿å¾—é«˜éšå‡½å¼çš„å¯¦ç¾è®Šå¾—å¯èƒ½ï¼Œå› ç‚ºå‡½å¼å¯ä»¥ä½œç‚ºåƒæ•¸å‚³å…¥æˆ–è¿”å›ã€‚
ç¾ä»£ç¨‹å¼èªè¨€å¦‚ JavaScriptã€Python å‡æ”¯æ´ä¸€ç´šå‡½å¼ã€‚


==== çµè«–
é«˜éšå‡½å¼å…è¨±æ›´éˆæ´»çš„é‚è¼¯çµ„åˆï¼Œèƒ½æœ‰æ•ˆæå‡ç¨‹å¼ç¢¼çš„é‡ç”¨æ€§å’Œå¯è®€æ€§ï¼Œæ¸›å°‘ä»£ç¢¼çš„é‡è¤‡å’Œå†—é¤˜ã€‚



































== å‡½å¼(é–‰åŒ…ã€thisã€ç®­é ­å‡½å¼)

* é–‰åŒ… 
* this
* Arrow Function

å ±å‘Šäºº: 04 é—•æ–ˆäº¦

=== é–‰åŒ… Closure

==== ä¸ä½¿ç”¨é–‰åŒ…ï¼ˆclosureï¼‰çš„æƒ…æ³

åœ¨ JavaScript ä¸­ï¼Œglobal variable çš„éŒ¯ç”¨å¯èƒ½æœƒä½¿å¾—æˆ‘å€‘çš„ç¨‹å¼ç¢¼å‡ºç¾ä¸å¯é æœŸçš„éŒ¯èª¤ã€‚

[source,javascript]
----
// ç‹—çš„è¨ˆæ•¸ç¨‹å¼
let dogCount = 0;

function countDogs() {
dogCount += 1;
console.log(dogCount + ' dog(s)');
}

countDogs(); // 1 dog(s)
countDogs(); // 2 dog(s)
countDogs(); // 3 dog(s)
----

æ¥è‘—ç¹¼çºŒå¯«ç¨‹å¼çš„å…¶ä»–éƒ¨åˆ†ï¼Œç•¶å¯«åˆ°ç¨‹å¼çš„å¾Œé¢æ™‚ï¼Œæˆ‘ç™¼ç¾æˆ‘ä¹Ÿéœ€è¦å¯«è²“çš„è¨ˆæ•¸ç¨‹å¼ï¼Œæ–¼æ˜¯æˆ‘åˆé–‹å§‹å¯«äº†è²“çš„è¨ˆæ•¸ç¨‹å¼ï¼š

[source,javascript]
----
// ç‹—çš„è¨ˆæ•¸å‡½å¼
let dogCount = 0;

function countDogs() {
dogCount += 1;
console.log(dogCount + ' dog(s)');
}

// ä¸­é–“æ˜¯å…¶ä»–ç¨‹å¼ç¢¼...

// è²“çš„è¨ˆæ•¸å‡½å¼
let catCount = 0;

function countCats() {
catCount += 1;
console.log(catCount + ' cat(s)');
}

countCats(); // 1 cat(s)
countCats(); // 2 cat(s)
countCats(); // 3 cat(s)
----

==== ä½¿ç”¨é–‰åŒ…ï¼ˆClosureï¼‰ä¾†é¿å…è®Šæ•¸è¡çª
å¦‚æœä¸ä½¿ç”¨é–‰åŒ…ï¼Œæœƒå‡ºç¾å…¨åŸŸè®Šæ•¸çš„å•é¡Œï¼Œä¾‹å¦‚ï¼š
[source,javascript]
----
let dogCount = 0;

function countDogs() {
dogCount += 1;
console.log(dogCount + ' dog(s)');
}

function countCats() {
dogCount += 1;
console.log(dogCount + ' cat(s)');
}

countDogs(); // 1 dog(s)
countCats(); // 2 dog(s)ï¼Œæ‡‰è©²æ˜¯ 1 cat(s)
----

åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œ *countDogs()* å’Œ *countCats()* å…±äº«äº†åŒä¸€å€‹ dogCount ï¼Œé€™æ¨£æœƒç”¢ç”Ÿæ··äº‚ã€‚
ç‚ºäº†è§£æ±ºé€™å€‹å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨é–‰åŒ…ä¾†å‰µå»ºä¸€å€‹ç§æœ‰è®Šæ•¸ï¼š
[source,javascript]
----
function createCounter(animalType) {
let animalCount = 0;
return function () {
animalCount += 1;
console.log(animalCount + ' ' + animalType);
};
}

const countDogs = createCounter('dogs');
const countCats = createCounter('cats');

countDogs(); // 1 dogs
countCats(); // 1 cats
countDogs(); // 2 dogs
----

é€éé–‰åŒ…ï¼Œæˆ‘å€‘å‰µå»ºäº†ä¸€å€‹æ–°çš„ä½œç”¨åŸŸç¯„åœï¼Œé€™ä½¿å¾—æ¯æ¬¡å‘¼å« createCounter æ™‚ï¼Œè®Šæ•¸ animalCount éƒ½æœƒé‡ç½®ï¼Œä¸¦ä¸”è©²è®Šæ•¸åªèƒ½åœ¨è©²ä½œç”¨åŸŸå…§éƒ¨å­˜å–
ï¼Œè€Œä¸æœƒè¢«å…¶ä»–åœ°æ–¹ä¿®æ”¹ã€‚

é€™æ¨£æˆ‘å€‘å°±å°‡å°ˆé–€è¨ˆç®—ç‹—çš„è®Šæ•¸ animalCount é—œé–‰åœ¨ dogHouse é€™å€‹å‡½å¼ä¸­ï¼Œä¸Šé¢é€™æ˜¯é–‰åŒ…çš„åŸºæœ¬å¯«æ³•ï¼Œ
*ç•¶ä½ çœ‹åˆ°ä¸€å€‹ function å…§ return äº†å¦ä¸€å€‹ functionï¼Œé€šå¸¸å°±æ˜¯æœ‰ç”¨åˆ°é–‰åŒ…çš„æ¦‚å¿µã€‚*

==== é€²ä¸€æ­¥ç­è§£å’Œä½¿ç”¨é–‰åŒ…
åœ¨é‹ç”¨çš„æ˜¯åŒä¸€å€‹ dogHouse æ™‚ï¼Œè®Šæ•¸é–“ä¹Ÿéƒ½æ˜¯ç¨ç«‹çš„åŸ·è¡Œç’°å¢ƒä¸æœƒå¹²æ“¾ï¼Œä¾‹å¦‚ï¼š
[source,javascript]
----
function dogHouse() {
let dogCount = 0;
return function countDogs() {
dogCount += 1;
console.log(dogCount + ' dogs');
};
}

// é›–ç„¶éƒ½æ˜¯ä½¿ç”¨ dogHouse ï¼Œä½†æ˜¯å„æ˜¯ä¸åŒçš„åŸ·è¡Œç’°å¢ƒ
// å› æ­¤å½¼æ­¤çš„è®Šæ•¸ä¸æœƒäº’ç›¸å¹²æ“¾

const countGolden = dogHouse();
const countPug = dogHouse();
const countPuppy = dogHouse();

countGolden(); // 1 dogs
countGolden(); // 2 dogs

countPug(); // 1 dogs
countPuppy(); // 1 dogs

countGolden(); // 3 dogs
countPug(); // 2 dogs
----
==== å°‡åƒæ•¸ä»£å…¥é–‰åŒ…ä¸­
ä½†æ˜¯é€™éº¼åšä½ å¯èƒ½è¦ºå¾—ä¸å¤ æ¸…æ¥šï¼Œå› ç‚ºéƒ½æ˜¯å«åš dogsï¼Œé€™æ™‚å€™æˆ‘å€‘ä¸€æ¨£å¯ä»¥æŠŠå¤–é¢çš„è®Šæ•¸é€éå‡½å¼çš„åƒæ•¸ä»£å…¥é–‰åŒ…ä¸­ï¼Œåƒæ˜¯ä¸‹é¢é€™æ¨£ï¼Œ
å›å‚³çš„çµæœå°±æ¸…æ¥šå¤šäº†ï¼š
[source,javascript]
----
// é€éå‡½å¼çš„åƒæ•¸å°‡å€¼ä»£å…¥é–‰åŒ…ä¸­
function dogHouse(animalName) {
let dogCount = 0;
return function () {
dogCount += 1;
console.log(dogCount + ' ' + animalName);
};
}

// åŒæ¨£æ˜¯ä½¿ç”¨ dogHouse ä½†æ˜¯ä½¿ç”¨ä¸åŒçš„åƒæ•¸
const countGolden = dogHouse('Golden');
const countPug = dogHouse('Pug');
const countPuppy = dogHouse('Puppy');

// çµæœæ›´æ¸…æ¥šäº†
countGolden(); // 1 Golden
countGolden(); // 2 Golden

countPug(); // 1 Pug
countPuppy(); // 1 Puppy

countGolden(); // 3 Golden
countPug(); // 2 Pug
----
==== é€²ä¸€æ­¥ç°¡åŒ–ç¨‹å¼
===== ç›´æ¥ return function
æ¥è‘—ï¼Œå¦‚æœæˆ‘å€‘ç†Ÿæ‚‰åœ¨é–‰åŒ…ä¸­æœƒ return ä¸€å€‹ function å‡ºä¾†ï¼Œæˆ‘å€‘å°±å¯ä»¥ä¸å¿…ç‚ºè£¡é¢çš„å‡½å¼å‘½åï¼Œè€Œæ˜¯ç”¨åŒ¿åå‡½å¼çš„æ–¹å¼ç›´æ¥æŠŠå®ƒå›å‚³å‡ºä¾†ã€‚
å› æ­¤å¯«æ³•å¯ä»¥ç°¡åŒ–æˆé€™æ¨£ï¼š
[source,javascript]
----
function dogHouse() {
let dogCount = 0;
// æŠŠåŸæœ¬ countDogs å‡½å¼æ”¹æˆåŒ¿åå‡½å¼ç›´æ¥æ”¾é€²ä¾†
return function () {
dogCount += 1;
console.log(dogCount + ' dogs');
};
}

function catHouse() {
let catCount = 0;
// æŠŠåŸæœ¬ countCats å‡½å¼æ”¹æˆåŒ¿åå‡½å¼ç›´æ¥æ”¾é€²ä¾†
return function () {
catCount += 1;
console.log(catCount + ' cats');
};
}
----
==== ä½¿ç”¨ let
åœ¨ ES6 ä¸­æå‡ºäº†æ–°çš„ç”¨ä¾†å®šç¾©è®Šæ•¸çš„é—œéµå­— let ï¼Œç°¡å–®ä¾†èªªï¼Œé€é let å®ƒå¯ä»¥å¹«æˆ‘å€‘æŠŠæ‰€å®šç¾©çš„è®Šæ•¸ç¸®é™åœ¨ block scoped ä¸­ï¼Œ
ä¹Ÿå°±æ˜¯è®Šæ•¸çš„ä½œç”¨åŸŸåªæœ‰åœ¨ { } å…§ï¼Œå› æ­¤è¦è§£æ±ºä¸Šé¢ç¨‹å¼ç¢¼çš„å•é¡Œï¼Œ
æˆ‘å€‘ä¹Ÿå¯ä»¥é€é let ä¾†é¿å… *buttonName* é€™å€‹è®Šæ•¸è·‘åˆ° global variable è¢«é‡è¤‡è¦†è“‹ã€‚
[source,javascript]
----
// ä½¿ç”¨ ES6 å¯«æ³•
for (let index = 0; index < buttons.length; index++) {
let buttonName = buttons[index].innerHTML;
buttons[index].addEventListener('click', saveButtonName(buttonName));
}
----


===== ç‰©ä»¶æ–¹æ³• (Object Method)

ç‰©ä»¶é€šå¸¸å°æ‡‰åˆ°çœŸå¯¦ä¸–ç•Œçš„äº‹ç‰©ï¼Œä¾‹å¦‚ç”¨æˆ¶ã€è¨‚å–®ã€å•†å“ç­‰ã€‚ç‰©ä»¶é€šå¸¸ä¹Ÿæœƒæœ‰è‡ªå·±çš„ã€Œå‹•ä½œã€ï¼Œ
å¯èƒ½æ˜¯ç”±ä¸€é€£ä¸²çš„è³‡æ–™æ“ä½œã€ç¶²è·¯è«‹æ±‚ç­‰æ§‹æˆçš„æœ‰æ„ç¾©çš„è¡Œç‚ºï¼Œä¾‹å¦‚ç”¨æˆ¶çš„ç™»å…¥ç™»å‡ºã€è¨‚å–®çµå¸³å–æ¶ˆã€å•†å“åŠ å…¥è³¼ç‰©è»Šç­‰ã€‚

é€™äº›ã€Œå‹•ä½œã€åœ¨ JavaScript ä¸­ï¼Œå¯ä»¥ç”¨ç‰©ä»¶æ–¹æ³• (object method) ä¾†å¯¦ä½œã€‚

æ‰€è¬‚çš„ç‰©ä»¶æ–¹æ³•ï¼Œå°±æ˜¯ç‰©ä»¶å¯ä»¥å‘¼å«çš„æ–¹æ³•ã€‚

æ¯”æ–¹èªªï¼Œæˆ‘å€‘å®šç¾©ä¸€å€‹ä½¿ç”¨è€…çš„ç‰©ä»¶ userï¼š

[source,javascript]
----
const userObject = {
userName: 'Shubo',
};
----
æˆ‘å€‘å¯ä»¥å¹« userObject ç‰©ä»¶æ–°å¢ä¸€å€‹ *speak()* çš„ç‰©ä»¶æ–¹æ³•ï¼š
[source,javascript]
----
userObject.speak = function() {
console.log('Hello world!');
}
----
é€™æ¨£ userObject ç‰©ä»¶å°±å¯ä»¥å‘¼å«é€™å€‹ *speak()* æ–¹æ³•ï¼š
[source,javascript]
----
userObject.speak(); // Hello world!
----
==== ä»€éº¼æ˜¯ thisï¼Ÿ

å¦‚æœæˆ‘å€‘åœ¨ç‰©ä»¶æ–¹æ³•ä¸­ï¼Œè¦å­˜å–ç‰©ä»¶æœ¬èº«çš„è³‡æ–™æˆ–å±¬æ€§è©²æ€éº¼è¾¦å‘¢ï¼Ÿ

æ¯”æ–¹èªªï¼Œæˆ‘å€‘å¸Œæœ›ä½¿ç”¨è€…å‘¼å« *speak()* æ–¹æ³•çš„æ™‚å€™ï¼Œå¯ä»¥é †ä¾¿ä»‹ç´¹ä½¿ç”¨è€…è‡ªå·±çš„åå­—ã€‚

é€™å€‹æ™‚å€™ this å°±æ´¾ä¸Šç”¨å ´å•¦ï¼

åœ¨ç‰©ä»¶æ–¹æ³•ä¸­ï¼Œè¦å­˜å–ç‰©ä»¶æœ¬èº«ï¼Œæˆ‘å€‘å¯ä»¥ç”¨é—œéµå­— thisã€‚

this çš„å€¼å°±æ˜¯æ–¹æ³•çš„å‘¼å«è€…ï¼Œä¹Ÿå°±æ˜¯å‘¼å«æ–¹æ³•çš„ç‰©ä»¶ã€‚

[source,javascript]
----
const userObject = {
userName: 'Shubo',
speak() {
console.log('Hello world! My name is ' + this.userName); // (1)
}
};

userObject.speak(); // (2) Hello world! My name is Shubo
----

ä¸Šé¢çš„ä¾‹å­æˆ‘å€‘å¯ä»¥çœ‹åˆ°ï¼š(1) æˆ‘å€‘åœ¨ç‰©ä»¶çš„ *speak()* æ–¹æ³•ä¸­ç”¨åˆ°äº† this.userNameï¼Œæ¥è‘— (2) æˆ‘å€‘å»å‘¼å« *userObject.speak()*ã€‚

é€™è£çš„ this æ˜¯ userObject ç‰©ä»¶ã€‚ç‚ºä»€éº¼å‘¢ï¼Ÿ

å› ç‚ºã€Œå‘¼å« *speak()* æ–¹æ³•çš„ç‰©ä»¶ã€æ˜¯ userObject ç‰©ä»¶ï¼Œæ‰€ä»¥ *speak()* æ–¹æ³•ä¸­çš„ this å°±ç­‰æ–¼ userObject ç‰©ä»¶ã€‚


==== this çš„å€¼æ˜¯å‹•æ…‹æ±ºå®šçš„
this åœ¨ä¸åŒæƒ…æ³ä¸‹çš„å€¼æ˜¯ä¸ä¸€æ¨£çš„ã€‚ä»¥ä¸‹æ˜¯å€‹ä¾‹å­ï¼š
[source,javascript]
----
const userObject = {
userName: 'Chris',
speak() {
console.log('Hello, my name is ' + this.userName);
}
};

const anotherUserObject = { userName: 'John' };

anotherUserObject.speak = userObject.speak;

userObject.speak(); // Hello, my name is Chris
anotherUserObject.speak(); // Hello, my name is John
----

åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œspeak() æ–¹æ³•æœƒæ ¹æ“šå®ƒæ‰€å±¬çš„ç‰©ä»¶ä¾†æ±ºå®š this çš„å€¼ã€‚

==== this åœ¨ç®­é ­å‡½å¼ä¸­çš„ç‰¹æ€§
ç®­é ­å‡½å¼æ²’æœ‰è‡ªå·±çš„ thisï¼Œå®ƒæœƒç¹¼æ‰¿å¤–å±¤çš„ thisã€‚æˆ‘å€‘å¯ä»¥é€šéä»¥ä¸‹ä¾‹å­ä¾†ç†è§£ï¼š
[source,javascript]
----
const userObject = {
userName: 'Shubo',
speak: function() {
const normalFunction = function() {
console.log('Normal function: Hello, my name is ' + this.userName);
};
normalFunction(); // Normal function: Hello, my name is undefined

const arrowFunction = () => {
console.log('Arrow function: Hello, my name is ' + this.userName);
};
arrowFunction(); // Arrow function: Hello, my name is Shubo
}
};

userObject.speak();
----
åœ¨ normalFunction ä¸­ï¼Œthis æŒ‡å‘çš„æ˜¯å…¨å±€å°è±¡ï¼ˆåœ¨ç€è¦½å™¨ä¸­æ˜¯ windowï¼‰ï¼Œå› æ­¤ this.userName æ˜¯ undefinedï¼Œ
å› ç‚º window æ²’æœ‰ userName å±¬æ€§ã€‚
åœ¨ arrowFunction ä¸­ï¼Œthis æ˜¯å¾å®ƒæ‰€åœ¨çš„ä½œç”¨åŸŸï¼ˆå³ *speak()* æ–¹æ³•ï¼‰ç¹¼æ‰¿è€Œä¾†ï¼Œé€™å€‹ this æ˜¯æŒ‡ userObject 
.userName æ˜¯ Shuboã€‚

==== è©²å¦‚ä½•åˆ¤æ–· this çš„å€¼ï¼Ÿ

æˆ‘å€‘å¯ä»¥ç°¡å–®æ­¸ç´å‡ºæ±ºå®š this çš„è¦å‰‡ï¼š
*
this å°±æ˜¯å‘¼å«æ–¹æ³•æ™‚ï¼Œã€Œé»ã€å‰é¢çš„é‚£å€‹ç‰©ä»¶ã€‚
*
è€Œç®­é ­å‡½å¼æ²’æœ‰è‡ªå·±çš„ thisï¼Œä»–çš„ this ç”±å¤–å±¤çš„ç’°å¢ƒæ±ºå®šã€‚


==== ä»€éº¼æ˜¯ç®­é ­å‡½å¼ï¼ˆArrow Functionï¼‰
===== ç®­é ­å‡½å¼ç°¡åŒ–å¯«æ³•
ä½¿ç”¨ç®­é ­å‡½å¼å¯ä»¥è®“å‡½å¼è®Šå¾—æ›´ç°¡æ½”ï¼Œå°¤å…¶æ˜¯åªæœ‰ä¸€å€‹è¡¨é”å¼æ™‚ï¼Œä¸éœ€è¦ return å’Œå¤§æ‹¬è™Ÿï¼š
[source,javascript]
----
// å‚³çµ±å‡½å¼å¯«æ³•
function squareFunction(inputNumber) {
return inputNumber * inputNumber;
}

// ä½¿ç”¨ç®­é ­å‡½å¼
const squareArrowFunction = inputNumber => inputNumber * inputNumber;

console.log(squareArrowFunction(5)); // 25
----

==== ç®­é ­å‡½å¼ä¸­çš„ this
ç®­é ­å‡½å¼çš„ this æ°¸é æŒ‡å‘å®ƒè¢«å®šç¾©æ™‚çš„ä¸Šä¸‹æ–‡ï¼š
[source,javascript]
----
const userObject = {
userName: 'Alice',
sayHello: () => {
console.log('Hello, ' + this.userName);
}
};

userObject.sayHello(); // Hello, undefined
----
å› ç‚ºç®­é ­å‡½å¼çš„ this æ˜¯ç¹¼æ‰¿è‡ªå¤–å±¤ä½œç”¨åŸŸï¼Œè€Œä¸æ˜¯ç‰©ä»¶æœ¬èº«ï¼Œæ‰€ä»¥é€™è£¡çš„ this.userName æ˜¯ undefinedã€‚è‹¥è¦åœ¨ç‰©ä»¶æ–¹æ³•ä¸­æ­£ç¢ºä½¿ç”¨ thisï¼Œ
æ‡‰è©²é¿å…ä½¿ç”¨ç®­é ­å‡½å¼ã€‚

===== ç”± call èˆ‡ apply å‡½å¼å‘¼å«

ç”±æ–¼ç®­é ­å‡½å¼ä¸¦æ²’æœ‰è‡ªå·±çš„ thisï¼Œæ‰€ä»¥é€é *call()* æˆ– *apply()* å‘¼å«ç®­é ­å‡½å¼åªèƒ½å‚³å…¥åƒæ•¸ã€‚thisArg å°‡æœƒè¢«å¿½ç•¥ã€‚

[source,javascript]
----
const adderObject = {
baseValue: 1,
addFunction: function (inputValue) {
const arrowFunction = (value) => value + this.baseValue;
return arrowFunction(inputValue);
},
addThruCallFunction: function (inputValue) {
const arrowFunction = (value) => value + this.baseValue;
const newBaseObject = {
baseValue: 2,
};
return arrowFunction.call(newBaseObject, inputValue);
},
};
console.log(adderObject.addFunction(1)); // é¡¯ç¤º 2
console.log(adderObject.addThruCallFunction(1)); // ä¾èˆŠé¡¯ç¤º 2
----

===== ä½¿ç”¨ new é‹ç®—å­

ç®­é ­å‡½å¼ä¸å¯ä½œç‚ºå»ºæ§‹å¼ä½¿ç”¨ï¼›è‹¥ä½¿ç”¨æ–¼å»ºæ§‹å¼ï¼Œæœƒåœ¨ä½¿ç”¨ new æ™‚å€™æ‹‹å‡ºéŒ¯èª¤ã€‚

[source,javascript]
----
const FooArrowFunction = () => {};
const fooInstance = new FooArrowFunction(); // TypeError: FooArrowFunction is not a constructor
----

===== ä½¿ç”¨ prototype å±¬æ€§
ç®­é ­å‡½å¼ä¸¦æ²’æœ‰åŸå‹ï¼ˆprototypeï¼‰å±¬æ€§ã€‚
[source,javascript]
----
const ArrowPersonFunction = (inputName) => {
this.name = inputName;
};

// å˜—è©¦ç‚ºç®­é ­å‡½å¼æ·»åŠ åŸå‹æ–¹æ³•
ArrowPersonFunction.prototype.sayHello = function () {
console.log('Hello, ' + this.name);
};

const personInstance = new ArrowPersonFunction('Bob'); // TypeError: ArrowPersonFunction is not a constructor
----
*ç‚ºä»€éº¼ç®­é ­å‡½å¼æ²’æœ‰ prototypeï¼Ÿ*
ç®­é ­å‡½å¼çš„è¨­è¨ˆåˆè¡·æ˜¯ç”¨ä¾†è™•ç†ç°¡å–®çš„å›èª¿å’Œå…§éƒ¨é‚è¼¯ï¼Œå®ƒå€‘å°ˆæ³¨æ–¼é–‰åŒ…å’Œ this ç¶å®šï¼Œè€Œä¸æ˜¯ä½œç‚ºæ§‹é€ å‡½å¼ä½¿ç”¨ã€‚
å› æ­¤ï¼Œå®ƒå€‘ä¸å…·å‚™ prototype å±¬æ€§ï¼Œä¹Ÿç„¡æ³•è¢«ç”¨ä¾†å¯¦ä¾‹åŒ–å°è±¡ã€‚

===== å‡½å¼ä¸»é«”ï¼ˆFunction Bodyï¼‰
åœ¨ concise body è£¡é¢åªéœ€è¦è¼¸å…¥é‹ç®—å¼ï¼Œå°±æœƒé™„ä¸Šå…§å»ºçš„å›å‚³ã€‚åœ¨ block body è£¡é¢å°±å¿…é ˆé™„ä¸Šæ˜ç¢ºçš„ return å®£å‘Šã€‚
[source,javascript]
----
const conciseFunction = (inputValue) => inputValue * inputValue; // concise èªæ³•æœƒå…§å»º "return"
const blockFunction = (inputX, inputY) => {
return inputX + inputY;
}; // block body éœ€è¦æ˜ç¢ºçš„ "return"
----

===== æ›è¡Œ
ç®­é ­å‡½å¼ä¸å¯ä»¥åœ¨åƒæ•¸åŠç®­é ­é–“åŒ…å«æ›è¡Œã€‚
[source,javascript]
----
// éŒ¯èª¤å¯«æ³•
const addFunction = (inputA, inputB)
=> inputA + inputB;
// æ­£ç¢ºå¯«æ³•1 // éš±å¼è¿”å›
const addFunctionCorrect1 = (inputA, inputB) => inputA + inputB;
// æ­£ç¢ºå¯«æ³•2 // é¡¯å¼è¿”å›
const addFunctionCorrect2 = (inputA, inputB) => {
return inputA + inputB;
};
----






































=== éåŒæ­¥(åŒæ­¥/éåŒæ­¥å·®ç•°ã€XMLHttpRequest/fetchã€AJAXã€Promise)


==== ç›®éŒ„

* <<sync_async_concept,åŒæ­¥èˆ‡éåŒæ­¥æ¦‚å¿µ>>
  ** <<what_is_sync,åŒæ­¥æ˜¯ä»€éº¼ï¼Ÿ>>
  ** <<what_is_async,éåŒæ­¥æ˜¯ä»€éº¼ï¼Ÿ>>
  ** <<why_need_async,ç‚ºä»€éº¼éœ€è¦éåŒæ­¥>>
  ** <<why_async,ç‚ºä»€éº¼ JavaScript å¯ä»¥éåŒæ­¥ï¼Ÿ>>


* <<ajax_requests,AJAX èˆ‡æ•¸æ“šè«‹æ±‚>>
  ** <<what_is_ajax,ä»€éº¼æ˜¯ AJAX?>>
  ** <<what_is_xmlhttprequest,XMLHttpRequest>>
  ** <<what_is_fetch,Fetch>>
  ** <<xmlhttprequest_vs_fetch,XMLHttpRequest vs. Fetch>>

* <<promise_async_handling,Promise èˆ‡éåŒæ­¥è™•ç†>>
  ** <<what_is_promise,Promise>>
    *** <<promise_states,Promise çš„ç‹€æ…‹>>
    *** <<promise_structure,Promise çš„åŸºæœ¬çµæ§‹>>
    *** <<promise_chain_structure,Promise çš„éˆå¼çµæ§‹>>
    *** <<promise_flexibility,Promise çš„éˆæ´»æ‡‰ç”¨>>
      **** <<promise_all,Promise.all()>>
        ***** <<promise_all_example,Promise.all() å¯¦éš›ç¯„ä¾‹>>
      **** <<promise_allsettled,Promise.allSettled()>>
        ***** <<promise_allsettled_example,Promise.allSettled() å¯¦éš›ç¯„ä¾‹>>
      **** <<promise_race,Promise.race()>>
        ***** <<promise_race_example,Promise.race() å¯¦éš›ç¯„ä¾‹>>
      **** <<promise_any,Promise.any()>>
        ***** <<promise_any_example,Promise.any() å¯¦éš›ç¯„ä¾‹>>
  ** <<promise_methods_comparison,Promise æ–¹æ³•æ¯”è¼ƒ>>



[id=sync_async_concept]
=== åŒæ­¥èˆ‡éåŒæ­¥æ¦‚å¿µ

[id=what_is_sync]
==== åŒæ­¥æ˜¯ä»€éº¼ï¼Ÿ


ã€ŒåŒæ­¥ã€æŒ‡çš„æ˜¯ä¸€æ¬¡åªèƒ½åšä¸€ä»¶äº‹æƒ…ã€‚

JavaScript æ˜¯ã€Œå–®åŸ·è¡Œç·’ (Single-Thread)ã€èªè¨€ï¼Œé€™æ„å‘³è‘—å®ƒä¸€æ¬¡åªèƒ½åŸ·è¡Œä¸€å€‹ä»»å‹™ã€‚æ‰€æœ‰æ“ä½œéƒ½æœƒæŒ‰é †åºåŸ·è¡Œï¼Œé€™æ˜¯åŒæ­¥çš„æ¦‚å¿µã€‚


[source,javascript]
----

// Synchronous code example
console.log("Start");

console.log("Performing a synchronous task");

console.log("End");

----
[id=what_is_async]
==== éåŒæ­¥æ˜¯ä»€éº¼ï¼Ÿ

éåŒæ­¥å…è¨±å¤šå€‹ä»»å‹™ä¸¦è¡Œé€²è¡Œï¼Œç„¡éœ€ç­‰å¾…å‰ä¸€å€‹ä»»å‹™å®Œæˆã€‚éåŒæ­¥è™•ç†è®“ JavaScript å¯ä»¥åœ¨ä¸é˜»å¡ä¸»ç·šç¨‹çš„æƒ…æ³ä¸‹è™•ç†è€—æ™‚æ“ä½œï¼Œæ¯”å¦‚ç¶²çµ¡è«‹æ±‚æˆ–å®šæ™‚å™¨ã€‚


[source,javascript]
----

console.log("hello");
setTimeout(function() {
    console.log("End");
}, 1000);

for(let i = 0; i < 4; i++) {
    console.log(i);
}

----

åœ¨é€™å€‹ä¾‹å­ä¸­ï¼Œ#setTimeout# æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œï¼Œä¸¦ä¸æœƒé˜»å¡ JavaScript åŸ·è¡Œå…¶ä»–ä»£ç¢¼ã€‚å³ä½¿æˆ‘å€‘æŒ‡å®šå®ƒåœ¨ 1000 æ¯«ç§’å¾ŒåŸ·è¡Œï¼Œä½† JavaScript æœƒç¹¼çºŒåŸ·è¡Œå¾ŒçºŒçš„ #for# è¿´åœˆï¼Œè€Œä¸å¿…ç­‰å¾… #setTimeout# å®Œæˆã€‚


[id=why_need_async]
=== ç‚ºä»€éº¼éœ€è¦éåŒæ­¥ï¼Ÿä»€éº¼æ™‚å€™æœƒç”¨åˆ°ï¼Ÿ

==== Blocking

é˜»å¡ï¼ˆblockingï¼‰ æ˜¯æŒ‡ç¨‹å¼åœ¨åŸ·è¡ŒæŸå€‹æ“ä½œæ™‚ï¼Œå¿…é ˆç­‰å¾…è©²æ“ä½œå®Œæˆï¼Œæ‰èƒ½ç¹¼çºŒåŸ·è¡Œå¾ŒçºŒçš„ç¨‹å¼ç¢¼ã€‚åœ¨é˜»å¡éç¨‹ä¸­ï¼Œç¨‹å¼çš„åŸ·è¡Œæœƒæš«åœï¼Œç­‰å¾…æŸå€‹è³‡æºæˆ–æ“ä½œå®Œæˆï¼Œé€™æ®µæ™‚é–“å…§ï¼Œå…¶ä»–æ“ä½œç„¡æ³•é€²è¡Œã€‚é€™é€šå¸¸ç™¼ç”Ÿåœ¨æŸäº›éœ€è¦è¼ƒé•·æ™‚é–“æ‰èƒ½å®Œæˆçš„æ“ä½œä¸Šï¼Œæ¯”å¦‚ä»¥ä¸‹ï¼š


* *å‘ API ç™¼é€è«‹æ±‚*ï¼šè‹¥æ˜¯åŒæ­¥è™•ç†ï¼ŒJavaScript åœ¨ç­‰å¾… API å›æ‡‰æ™‚ï¼Œé é¢æœƒè¢«é–ä½ï¼Œä»€éº¼æ“ä½œéƒ½ç„¡æ³•é€²è¡Œã€‚

* *setTimeout*ï¼šå®šæ™‚å™¨å¦‚æœæ˜¯åŒæ­¥çš„ï¼Œå‰‡å¿…é ˆç­‰å¾…æ™‚é–“çµæŸï¼Œå…¶ä»–ä»£ç¢¼ç„¡æ³•åŸ·è¡Œã€‚

* *DOM æ“ä½œ*ï¼šè‹¥æ˜¯åŒæ­¥è™•ç†ï¼Œå‰‡åœ¨æ“ä½œ DOM çš„éç¨‹ä¸­ï¼Œæ•´å€‹é é¢ç„¡æ³•é€²è¡Œå…¶ä»–äº¤äº’ã€‚

ç‚ºäº†é¿å…é€™äº›é˜»å¡å•é¡Œï¼ŒJavaScript å¼•å…¥äº†éåŒæ­¥æ©Ÿåˆ¶ï¼Œè®“é•·æ™‚é–“åŸ·è¡Œçš„ä»»å‹™å¯ä»¥åœ¨å¾Œå°é€²è¡Œï¼Œä¸¦åœ¨å®Œæˆå¾Œé€šçŸ¥ä¸»åŸ·è¡Œç·šç¨‹ã€‚



=== link:../html/blocking-demo.html[é»æ“Šé€™è£¡æ“ä½œé é¢ä»¥äº†è§£é˜»å¡æ¦‚å¿µ]

[id=why_async]
=== ç‚ºä»€éº¼ JavaScript å¯ä»¥éåŒæ­¥ï¼Ÿ

é›–ç„¶ JavaScript æ˜¯å–®åŸ·è¡Œç·’èªè¨€ï¼Œä½†å®ƒå¯ä»¥é€éèˆ‡ç€è¦½å™¨çš„ Web API é€²è¡Œäº’å‹•ï¼Œå¯¦ç¾éåŒæ­¥è™•ç†ã€‚é€™æ¨£ï¼ŒJavaScript æœ¬èº«ä¾ç„¶æ˜¯åŒæ­¥çš„ï¼Œä½†é€é Web API å®ƒèƒ½å¤ ä¸¦è¡Œè™•ç†å¤šå€‹ä»»å‹™ï¼Œè€Œä¸æœƒé˜»å¡ä¸»ç·šç¨‹ã€‚

é€™äº› Web APIï¼ˆä¾‹å¦‚ï¼š#setTimeout#ã€#XMLHttpRequest#ã€#fetch#ï¼‰å…è¨±ç€è¦½å™¨ä»£ç‚ºè™•ç†ç•°æ­¥æ“ä½œï¼Œä¸¦åœ¨ä»»å‹™å®Œæˆå¾Œå°‡çµæœå‚³å› JavaScript å¼•æ“ã€‚


==== JavaScript çš„åŸ·è¡Œæ©Ÿåˆ¶

ç‚ºäº†ç†è§£ JavaScript æ˜¯å¦‚ä½•è™•ç†éåŒæ­¥æ“ä½œçš„ï¼Œæˆ‘å€‘éœ€è¦äº†è§£å®ƒçš„åŸ·è¡Œæ©Ÿåˆ¶ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å¹¾å€‹éƒ¨åˆ†ï¼š


* *Call Stack (èª¿ç”¨å †ç–Š)*ï¼šJavaScript åŸ·è¡ŒåŒæ­¥ä»£ç¢¼æ™‚ï¼Œæœƒä¾æ¬¡å°‡å‡½æ•¸æ¨å…¥èª¿ç”¨å †ç–Šï¼Œä¸¦å¾å †ç–Šä¸­å½ˆå‡ºåŸ·è¡Œå®Œæˆçš„å‡½æ•¸ã€‚

* *Web API* : Web API æ˜¯ç”±ç€è¦½å™¨æä¾›çš„ï¼Œå°ˆé–€ç”¨ä¾†è™•ç†ç•°æ­¥æ“ä½œã€‚ç•¶ JavaScript é‡åˆ°åƒ #setTimeout# æˆ– #fetch# é€™æ¨£çš„ç•°æ­¥æ“ä½œæ™‚ï¼Œæœƒå°‡å®ƒå€‘å§”è¨—çµ¦ Web API è™•ç†ï¼Œä¸¦ç¹¼çºŒåŸ·è¡Œå…¶ä»–åŒæ­¥ä»£ç¢¼ã€‚

* *Callback Queue (å›èª¿éšŠåˆ—)*ï¼šç•¶ Web API å®Œæˆç•°æ­¥æ“ä½œå¾Œï¼Œæœƒå°‡å›èª¿å‡½æ•¸æ”¾å…¥å›èª¿éšŠåˆ—ï¼Œç­‰å¾…ä¸»ç·šç¨‹ç©ºé–’æ™‚åŸ·è¡Œã€‚

* *Microtask Queue (å¾®ä»»å‹™éšŠåˆ—)*ï¼šé€™æ˜¯å°ˆé–€ç”¨ä¾†è™•ç†æ›´é«˜å„ªå…ˆç´šçš„ä»»å‹™ï¼Œæ¯”å¦‚ #Promise# çš„å›èª¿ã€‚å¾®ä»»å‹™åœ¨æ¯æ¬¡äº‹ä»¶å¾ªç’°çµæŸå¾Œæœƒç«‹å³åŸ·è¡Œã€‚

* *Macrotask Queue (å®ä»»å‹™éšŠåˆ—)*ï¼šå®ä»»å‹™åŒ…æ‹¬ #setTimeout# å’Œ #setInterval# ç­‰ç•°æ­¥æ“ä½œã€‚é€™äº›ä»»å‹™çš„å›èª¿æœƒåœ¨å¾®ä»»å‹™åŸ·è¡Œå®Œç•¢å¾ŒåŸ·è¡Œã€‚

[cols="2*a", frame="none", grid="none"]
|===
|image::../images/micro-task.png[scaledwidth=50%]
|image::../images/macro-task.png[scaledwidth=50%]
|===


==== äº‹ä»¶å¾ªç’° (Event Loop)

JavaScript ä½¿ç”¨ã€Œäº‹ä»¶å¾ªç’° (Event Loop)ã€ä¾†å”èª¿é€™äº›ä»»å‹™ã€‚äº‹ä»¶å¾ªç’°æœƒä¸æ–·æª¢æŸ¥èª¿ç”¨å †ç–Šæ˜¯å¦ç‚ºç©ºï¼Œå¦‚æœç‚ºç©ºï¼Œå°±æœƒå¾å›èª¿éšŠåˆ—ä¸­å–å‡ºä»»å‹™åŸ·è¡Œï¼Œå¾è€Œå¯¦ç¾éåŒæ­¥æ“ä½œã€‚


==== å®Œæ•´åŸ·è¡Œæµç¨‹

å®Œæ•´çš„éåŒæ­¥åŸ·è¡Œæµç¨‹å¦‚ä¸‹ï¼š

* JavaScript å°‡åŒæ­¥ä»£ç¢¼æ¨å…¥ Call Stack åŸ·è¡Œã€‚

* ç•¶é‡åˆ°ç•°æ­¥æ“ä½œæ™‚ï¼Œå°‡å…¶äº¤çµ¦ Web API è™•ç†ï¼Œä¸¦ç¹¼çºŒåŸ·è¡Œå…¶ä»–ä»£ç¢¼ã€‚

* Web API å®Œæˆä»»å‹™å¾Œï¼Œå°‡å›èª¿å‡½æ•¸æ”¾å…¥ Callback Queue è£¡çš„ Macrotask Queue æˆ– Microtask Queue ä¸­ã€‚

* äº‹ä»¶å¾ªç’°æª¢æŸ¥ Call Stack æ˜¯å¦ç©ºé–’ï¼Œè‹¥ç©ºé–’å‰‡ä¾æ¬¡è™•ç†å›èª¿éšŠåˆ—ä¸­çš„å›èª¿ã€‚

* Microtask Queue æœƒå„ªå…ˆæ–¼ Macrotask Queue åŸ·è¡Œã€‚

image::../images/eventloop.png[åœ–ç‰‡èªªæ˜]



==== ä¾‹å­å±•ç¤ºéåŒæ­¥é‹ä½œ

[source,javascript]
----

console.log("Start");

setTimeout(() => {
    console.log("Timeout callback");
}, 1000);

Promise.resolve().then(() => {
    console.log("Promise callback");
});

console.log("End");

// é€™æ®µä»£ç¢¼æœƒè¼¸å‡ºï¼š
// Start
// End
// Promise callback
// Timeout callback

----

Promise çš„å›èª¿æœƒé€²å…¥å¾®ä»»å‹™éšŠåˆ—ï¼ˆMicrotask Queueï¼‰ï¼Œè€Œ #setTimeout# çš„å›èª¿å‰‡é€²å…¥å®ä»»å‹™éšŠåˆ—ï¼ˆMacrotask Queueï¼‰ã€‚å¾®ä»»å‹™æœƒå„ªå…ˆåŸ·è¡Œï¼Œå› æ­¤ Promise çš„å›èª¿æœƒåœ¨ #setTimeout# ä¹‹å‰åŸ·è¡Œã€‚

=== link:http://latentflip.com/loupe/?code=JC5vbignYnV0dG9uJywgJ2NsaWNrJywgZnVuY3Rpb24gb25DbGljaygpIHsKICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gdGltZXIoKSB7CiAgICAgICAgY29uc29sZS5sb2coJ1lvdSBjbGlja2VkIHRoZSBidXR0b24hJyk7ICAgIAogICAgfSwgMjAwMCk7Cn0pOwoKY29uc29sZS5sb2coIkhpISIpOwoKc2V0VGltZW91dChmdW5jdGlvbiB0aW1lb3V0KCkgewogICAgY29uc29sZS5sb2coIkNsaWNrIHRoZSBidXR0b24hIik7Cn0sIDUwMDApOwoKY29uc29sZS5sb2coIldlbGNvbWUgdG8gbG91cGUuIik7!!!PGJ1dHRvbj5DbGljayBtZSE8L2J1dHRvbj4%3D[ğŸ¥ *é»æ“Šé€™è£¡æŸ¥çœ‹å®Œæ•´çš„äº‹ä»¶å¾ªç’°å¯è¦–åŒ–æ¼”ç¤º*]

[id=ajax_requests]
=== AJAX èˆ‡æ•¸æ“šè«‹æ±‚

[id=what_is_ajax]
==== ä»€éº¼æ˜¯ AJAX?

AJAXï¼ˆAsynchronous
link:https://developer.mozilla.org/zh-TW/docs/Glossary/JavaScript[JavaScript]
And
link:https://developer.mozilla.org/en-US/docs/Glossary/XML[XML]
ï¼ŒéåŒæ­¥ JavaScript èˆ‡ XMLï¼‰æ˜¯çµåˆäº†
link:https://developer.mozilla.org/zh-TW/docs/Glossary/HTML[HTML]
ã€
link:https://developer.mozilla.org/zh-TW/docs/Glossary/CSS[CSS]
ã€JavaScriptã€
link:https://developer.mozilla.org/zh-TW/docs/Glossary/DOM[DOM]
ã€é‚„æœ‰ #XMLHttpRequest# ç‰©ä»¶ï¼Œä»¥å»ºç«‹æ›´è¤‡é›œçš„ç¶²é æ‡‰ç”¨ã€‚AJAX
å…è¨±ç¶²é åªæ›´æ–°æ‰€éœ€çš„éƒ¨åˆ†ï¼Œè€Œç„¡éœ€é‡æ–°è¼‰å…¥æ•´å€‹é é¢ã€‚é›–ç„¶åå­—ä¸­æœ‰
XMLï¼Œä½†å®ƒä¹Ÿå¯ä»¥ç”¨ç¾ä»Šå»£æ³›ä½¿ç”¨çš„ JSON åŠå…¶ä»–è³‡æ–™é¡å‹ï¼ˆå¦‚ HTML, Form
Data, Binary Data, Blob, ArrayBufferï¼‰é€²è¡Œè³‡æ–™äº¤æ›ã€‚

[id=what_is_xmlhttprequest]
=== XMLHttpRequest

XMLHttpRequest æ˜¯ JavaScript ä¸­çš„ç‰©ä»¶ï¼Œå…è¨±ç¶²é å‘ä¼ºæœå™¨ç™¼é€ HTTP
æˆ– HTTPS
è«‹æ±‚ï¼Œä¸¦åœ¨ä¸é‡æ–°è¼‰å…¥æ•´å€‹ç¶²é çš„æƒ…æ³ä¸‹æ¥æ”¶å›æ‡‰è³‡æ–™ã€‚é€™é …æŠ€è¡“æ˜¯å¯¦ç¾
AJAX çš„é‡è¦çµ„æˆéƒ¨åˆ†ï¼Œèƒ½è®“ç¶²é å…§å®¹å‹•æ…‹æ›´æ–°ã€‚é›–ç„¶ç¾åœ¨å¸¸ç”¨ fetch()
æŠ€è¡“ï¼Œä½† XMLHttpRequest åœ¨æŸäº›è¼ƒèˆŠçš„é …ç›®ä¸­ä»ç„¶è¢«å»£æ³›ä½¿ç”¨ã€‚



==== XMLHttpRequest åŸºæœ¬æ¦‚å¿µ

====== 1. å»ºç«‹ XMLHttpRequest ç‰©ä»¶
[source,javascript]
----
let xhr = new XMLHttpRequest();
----

0
æ­¤æ™‚ä»ç‚ºåŒæ­¥èªå¥ï¼ŒéåŒæ­¥æ“ä½œå°šæœªé–‹å§‹
ç‰©ä»¶å‰µå»ºï¼šå‰µå»ºäº†ä¸€å€‹æ–°çš„XMLHttpRequestç‰©ä»¶
è¨˜æ†¶é«”åˆ†é…ï¼šxhrç‰©ä»¶è¢«åˆ†é…åœ¨è¨˜æ†¶é«”çš„Heapä¸­
åˆå§‹ç‹€æ…‹ï¼šæ­¤æ™‚xhr.readyStateçš„å€¼ç‚º0ï¼Œè¡¨ç¤ºUNSENT


0readyState ç‹€æ…‹å€¼ï¼š



* 0: UNSENT â€“ è«‹æ±‚å°šæœªæ‰“é–‹ã€‚

* 1: OPENED â€“ è«‹æ±‚å·²æ‰“é–‹ï¼Œä½†å°šæœªç™¼é€ã€‚

* 2: HEADERS_RECEIVED â€“ å·²æ”¶åˆ°ä¼ºæœå™¨å›æ‡‰æ¨™é ­ã€‚

* 3: LOADING â€“ è«‹æ±‚æ­£åœ¨è™•ç†ï¼Œå›æ‡‰çš„è³‡æ–™æ­£åœ¨æ¥æ”¶ã€‚

* 4: DONE â€“ è«‹æ±‚å·²å®Œæˆï¼Œå›æ‡‰å¯ç”¨ã€‚

====== 2. æ‰“é–‹è«‹æ±‚ (open)

[source,javascript]
----

xhr.open('GET', 'https://api.example.com/data', true);
----

è©²æ–¹æ³•åˆå§‹åŒ–äº†ä¸€å€‹HTTPè«‹æ±‚ï¼Œåªè½äº†è«‹æ±‚æ–¹æ³•èˆ‡URLï¼Œç¬¬ä¸‰å€‹åƒæ•¸ç‚ºtrueè¡¨ç¤ºéåŒæ­¥
æ­¤æ™‚xhr.readyStateçš„å€¼è®Šç‚º1
èª¿ç”¨ `open()` æ–¹æ³•åƒ…åƒ…æ˜¯è¨­å®šè«‹æ±‚åƒæ•¸ï¼Œé‚„æ²’é–‹å§‹ç¶²è·¯é€šè¨Š



====== 3. ç™¼é€è«‹æ±‚ (send)

[source,javascript]
----
xhr.send();
----

å¦‚æœæ˜¯ POST è«‹æ±‚ï¼Œå¯ä»¥å°‡è³‡æ–™ä»¥å­—ä¸²æ ¼å¼å‚³å…¥ send() ä¸­ï¼š

[source,javascript]
----

let data = JSON.stringify({ name: "Oscar", age: 24 });
xhr.send(data);
----


*æ­¤æ™‚ç€è¦½å™¨åšäº†ä»€éº¼ï¼Ÿ*


ä¸€ã€æº–å‚™ç™¼é€è«‹æ±‚

. æª¢æŸ¥ XMLHttpRequest ç‰©ä»¶çš„ç‹€æ…‹ +
ç¢ºèªç‹€æ…‹ç‚ºå·²åˆå§‹åŒ–ï¼šç¢ºä¿å·²ç¶“èª¿ç”¨äº† `open()` æ–¹æ³•ï¼Œ`readyState` ç‚º 1ï¼ˆOPENEDï¼‰ã€‚
ç¢ºèªè«‹æ±‚å·²è¨­å®šï¼šè«‹æ±‚æ–¹æ³•ã€URLã€åŒæ­¥æˆ–éåŒæ­¥æ­¥æ¨™èªŒç­‰å·²æ­£ç¢ºè¨­ç½®ã€‚

. è™•ç†Request Headers +
æ‡‰ç”¨é è¨­çš„Request Headersï¼šå¦‚ Acceptã€User-Agent ç­‰ã€‚
æ‡‰ç”¨é–‹ç™¼è€…è¨­ç½®çš„Request Headersï¼šå¦‚æœåœ¨èª¿ç”¨ `send()` ä¹‹å‰ä½¿ç”¨ `setRequestHeader()` è¨­ç½®äº†è‡ªå®šç¾©çš„ Request Headersï¼Œ
é€™äº›Headersæœƒåœ¨è«‹æ±‚ä¸­è¢«åŒ…å«ã€‚

. Request Body +
è™•ç†Request Bodyæ•¸æ“šï¼šå¦‚æœè«‹æ±‚æ–¹æ³•ç‚º POSTã€PUT ç­‰ï¼Œä¸¦ä¸”åœ¨ `send()` æ–¹æ³•ä¸­å‚³å…¥äº†Request Bodyï¼Œç€è¦½å™¨æœƒå°æ•¸æ“šé€²è¡Œé©ç•¶çš„ç·¨ç¢¼
ï¼ˆå¦‚å°‡ JavaScript ç‰©ä»¶è½‰æ›ç‚º JSON å­—ç¬¦ä¸²ï¼‰ã€‚


äºŒã€ç™¼é€ç¶²è·¯è«‹æ±‚

. é–‹å§‹ç¶²è·¯é€šè¨Š +
å§”æ´¾çµ¦Network Threadï¼šç€è¦½å™¨å°‡ç¶²è·¯è«‹æ±‚äº¤çµ¦Network Threadè™•ç†ï¼Œä»¥é¿å…é˜»å¡Main Threadï¼ˆJavaScript åŸ·è¡Œç’°å¢ƒï¼‰ã€‚
å»ºç«‹é€£æ¥ï¼šå¦‚æœèˆ‡ç›®æ¨™ä¼ºæœå™¨ä¹‹é–“æ²’æœ‰ç¾æœ‰çš„é€£æ¥ï¼Œç€è¦½å™¨æœƒå»ºç«‹ä¸€å€‹æ–°çš„ TCP é€£æ¥ï¼Œå¯èƒ½æœƒé€²è¡Œ DNS æŸ¥è©¢ã€TLS æ¡æ‰‹ç­‰ã€‚

. ç™¼é€ HTTP è«‹æ±‚ +
æ§‹å»º HTTP è«‹æ±‚ï¼šå°‡è«‹æ±‚æ–¹æ³•ã€URLã€HTTP ç‰ˆæœ¬ã€Request headerå’ŒRequest Bodyçµ„åˆæˆå®Œæ•´çš„ HTTP è«‹æ±‚å ±æ–‡ã€‚
ç™¼é€è«‹æ±‚å ±æ–‡ï¼šé€šéç¶²è·¯å°‡è«‹æ±‚å ±æ–‡ç™¼é€çµ¦ç›®æ¨™ä¼ºæœå™¨ã€‚


ä¸‰ã€è™•ç†è«‹æ±‚éç¨‹ä¸­çš„äº‹ä»¶

. æ›´æ–° readyState +
readyState è®ŠåŒ–ï¼šè«‹æ±‚ç™¼é€å¾Œï¼ŒreadyState ä»ç‚º 1ã€‚éš¨è‘—è«‹æ±‚çš„é€²å±•ï¼ŒreadyState æœƒç™¼ç”Ÿ1~4çš„è®ŠåŒ–ï¼š

. è§¸ç™¼äº‹ä»¶è™•ç†å™¨ +
onreadystatechange äº‹ä»¶ï¼šæ¯ç•¶ readyState ç™¼ç”Ÿè®ŠåŒ–æ™‚ï¼Œç€è¦½å™¨æœƒèª¿ç”¨ onreadystatechange å›èª¿å‡½æ•¸ã€‚


å››ã€æ¥æ”¶Response

. æ”¶åˆ°Response Header +
ç‹€æ…‹ç¢¼å’Œç‹€æ…‹æ–‡æœ¬ï¼šç€è¦½å™¨æ¥æ”¶åˆ°ä¼ºæœå™¨çš„Response Headerï¼Œç²å– HTTP ç‹€æ…‹ç¢¼ï¼ˆå¦‚ 200ã€404ï¼‰å’Œç‹€æ…‹æ–‡æœ¬ï¼ˆå¦‚ OKã€Not Foundï¼‰ã€‚
Response Headerè³‡è¨Šï¼šç²å–ä¼ºæœå™¨è¿”å›çš„Response Headerï¼Œå¦‚ Content-Typeã€Content-Lengthã€Set-Cookie ç­‰ã€‚

. æ›´æ–° readyState ç‚º 2 +
è§¸ç™¼ onreadystatechangeï¼šreadyState è®Šç‚º 2ï¼Œè§¸ç™¼ onreadystatechange å›èª¿ã€‚
. æ¥æ”¶Response é«”
æ•¸æ“šæµæ¥æ”¶ï¼šç€è¦½å™¨é–‹å§‹æ¥æ”¶Response é«”æ•¸æ“šï¼Œé€™å€‹éç¨‹å¯èƒ½æ˜¯æ¼¸é€²å¼çš„ï¼Œç‰¹åˆ¥æ˜¯å°æ–¼å¤§å‹æ–‡ä»¶ã€‚
æ›´æ–° readyState ç‚º 3ï¼š
è§¸ç™¼ onreadystatechangeï¼šreadyState è®Šç‚º 3ï¼Œè¡¨ç¤ºæ­£åœ¨æ¥æ”¶Response é«”ï¼Œè§¸ç™¼ onreadystatechange å›èª¿ã€‚
è§¸ç™¼ onprogressï¼šåœ¨æ¥æ”¶éç¨‹ä¸­ï¼Œå¤šæ¬¡è§¸ç™¼ onprogress äº‹ä»¶ï¼Œå¯ç”¨æ–¼æ›´æ–°ä¸‹è¼‰é€²åº¦ã€‚

. æ¥æ”¶å®Œæˆ +
æ›´æ–° readyState ç‚º 4ï¼š
readyState è®Šç‚º 4ï¼ˆDONEï¼‰ï¼Œè¡¨ç¤ºResponse å·²å®Œæ•´æ¥æ”¶ã€‚
è§¸ç™¼ onreadystatechangeï¼šæœ€å¾Œä¸€æ¬¡èª¿ç”¨ onreadystatechange å›èª¿ã€‚
è§¸ç™¼ onload æˆ– onerrorï¼š
å¦‚æœè«‹æ±‚æˆåŠŸï¼ˆHTTP ç‹€æ…‹ç¢¼ç‚º 2xx æˆ– 3xxï¼‰ï¼Œè§¸ç™¼ onload äº‹ä»¶ã€‚
å¦‚æœè«‹æ±‚å¤±æ•—ï¼ˆå¦‚ç¶²è·¯éŒ¯èª¤ã€è¶…æ™‚ç­‰ï¼‰ï¼Œè§¸ç™¼ onerror äº‹ä»¶ã€‚


*ç€è¦½å™¨çš„å…§éƒ¨æ©Ÿåˆ¶èˆ‡Thread*

image::../images/ProcessModel10.png[åœ–ç‰‡èªªæ˜]

. Main Thread +
JavaScript åŸ·è¡Œï¼šMain Threadè² è²¬åŸ·è¡Œæ‰€æœ‰çš„ JavaScript ç¨‹å¼ç¢¼ï¼ŒåŒ…æ‹¬èª¿ç”¨ send() æ–¹æ³•çš„ç¨‹å¼ç¢¼ã€‚
äº‹ä»¶å¾ªç’°ï¼šMain Threadè² è²¬è™•ç†äº‹ä»¶å¾ªç’°ï¼Œèª¿åº¦Task Queueä¸­çš„ä»»å‹™ã€‚

. Network Thread +
ç¶²è·¯è«‹æ±‚è™•ç†ï¼šç•¶èª¿ç”¨ send() æ–¹æ³•æ™‚ï¼Œç¶²è·¯è«‹æ±‚è¢«å§”æ´¾çµ¦ç€è¦½å™¨çš„Network Threadï¼Œä»¥éé˜»å¡çš„æ–¹å¼è™•ç†ã€‚
æ•¸æ“šæ¥æ”¶ï¼šNetwork Threadè² è²¬æ¥æ”¶ä¼ºæœå™¨çš„Response ï¼Œä¸¦å°‡ç›¸é—œäº‹ä»¶ï¼ˆå¦‚ onreadystatechangeï¼‰æ·»åŠ åˆ°Main Threadçš„Task Queueä¸­ã€‚

. ä»»å‹™èª¿åº¦ +
Event Loopï¼šMain Threadçš„äº‹ä»¶å¾ªç’°è² è²¬èª¿åº¦ä»»å‹™ï¼Œç•¶Network Threadæ¥æ”¶åˆ°æ•¸æ“šä¸¦è§¸ç™¼äº‹ä»¶æ™‚ï¼Œé€™äº›äº‹ä»¶çš„å›èª¿å‡½æ•¸æœƒè¢«æ·»åŠ 
åˆ°Task Queueï¼Œç­‰å¾…Main ThreadåŸ·è¡Œã€‚
éé˜»å¡ï¼šç”±æ–¼ç¶²è·¯è«‹æ±‚åœ¨Network Threadä¸­è™•ç†ï¼ŒMain Threadå¯ä»¥ç¹¼çºŒåŸ·è¡Œå…¶ä»–ç¨‹å¼ç¢¼ï¼Œä¸æœƒå› ç‚ºç­‰å¾…ç¶²è·¯è«‹æ±‚è€Œè¢«é˜»å¡ã€‚


----
èª¿ç”¨ xhr.send()
 |
 V
 ç€è¦½å™¨æª¢æŸ¥è«‹æ±‚è¨­å®šä¸¦æº–å‚™è«‹æ±‚
 |
 V
ç€è¦½å™¨å§”æ´¾ç¶²è·¯è«‹æ±‚çµ¦Network Thread
 |
 V
Network Threadè™•ç†ç¶²è·¯é€šè¨Šï¼Œç™¼é€è«‹æ±‚
 |
 V
è«‹æ±‚ç™¼å‡ºå¾Œï¼ŒMain Threadç¹¼çºŒåŸ·è¡Œå¾ŒçºŒç¨‹å¼ç¢¼
 |
 V
Network Threadæ¥æ”¶Response ï¼Œæ›´æ–° readyState
 |
 V
è§¸ç™¼å°æ‡‰çš„äº‹ä»¶ï¼ˆå¦‚ onreadystatechangeï¼‰ï¼Œæ·»åŠ åˆ°Main Threadçš„Task Queue
 |
 V
Main Threadçš„äº‹ä»¶å¾ªç’°èª¿åº¦ä¸¦åŸ·è¡Œå›èª¿å‡½æ•¸
 |
 V
 åœ¨å›èª¿å‡½æ•¸ä¸­è™•ç†Response æ•¸æ“šï¼Œæ›´æ–°é é¢ç­‰

----

====== 4. è™•ç†å›æ‡‰ (response)

å¯ä»¥é€é #onreadystatechange# æˆ–
#onload# ç›£è½è«‹æ±‚çš„ç‹€æ…‹è®ŠåŒ–ä¸¦è™•ç†å›æ‡‰ï¼š



[source,javascript]
----

xhr.onreadystatechange = function() {
    if (xhr.readyState === 4 && xhr.status === 200) {
        console.log(xhr.responseText); // è¼¸å‡ºä¼ºæœå™¨å›æ‡‰çš„è³‡æ–™
    }
};
----




[source,javascript]
----

xhr.onload = function() {
    if (xhr.status >= 200 && xhr.status < 300) {
        console.log(xhr.responseText); // è™•ç†å›æ‡‰è³‡æ–™
    } else {
        console.error('è«‹æ±‚å¤±æ•—');
    }
};
----



=== Fetch

[id=what_is_fetch]
==== ä»€éº¼æ˜¯ Fetchï¼Ÿ


*Fetch API* æ˜¯
*XMLHttpRequest* çš„ç¾ä»£æ›¿ä»£å“ã€‚å®ƒä½¿ç”¨
*Promise* ä¾†è™•ç†éåŒæ­¥æ“ä½œï¼Œè¨­è¨ˆæ›´åŠ éˆæ´»ä¸”ç°¡æ½”ã€‚


[source,javascript]
----

fetch('https://api.example.com/products')
.then(response => {
    if (!response.ok) {
        throw new Error('ç¶²è·¯å›æ‡‰æœ‰èª¤ï¼š' + response.statusText);
    }
    return response.json();// è§£æ JSON è³‡æ–™
})
.then(products => {
    console.log(products);// è™•ç†ä¸¦é¡¯ç¤ºç”¢å“
})
.catch(error => {
    console.error('Fetch æ“ä½œä¸­å‡ºç¾å•é¡Œï¼š', error);
});
----


==== ä½¿ç”¨ Fetch ç™¼é€ POST è«‹æ±‚

å‡è¨­ç”¨æˆ¶å°‡ç”¢å“åŠ å…¥è³¼ç‰©è»Šï¼Œå¯ä»¥ä½¿ç”¨ Fetch ç™¼é€ POST è«‹æ±‚ï¼š

[source,javascript]
----

fetch('https://api.example.com/cart', {
    method: 'POST',
    headers: {
    'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        productId: 12345,
        quantity: 1
    })
})
.then(response => response.json())
.then(data => console.log('ç”¢å“å·²åŠ å…¥è³¼ç‰©è»Šï¼š', data))
.catch(error => console.error('åŠ å…¥è³¼ç‰©è»Šæ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š', error));
----


[id=xmlhttprequest_vs_fetch]
==== XMLHttpRequest vs. Fetch

===== XMLHttpRequest ç¯„ä¾‹ï¼š

[source,javascript]
----

var xhr = new XMLHttpRequest();
xhr.open('GET', 'https://api.example.com/data', true);
xhr.onload = function() {
    if (xhr.status >= 200 && xhr.status < 300) {
        var data = JSON.parse(xhr.responseText);
        console.log(data);
    } else {
        console.error('Error:', xhr.statusText);
    }
};
xhr.onerror = function() {
    console.error('Request failed');
};
xhr.send();

----


==== Fetch ç¯„ä¾‹ï¼š

[source,javascript]
----

fetch('https://api.example.com/data')
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));
----
[cols="1,1,1", options="header", frame="all", grid="all"]
|===
| æ¯”è¼ƒ | Fetch API | XMLHttpRequest

| *èªæ³•å’Œæ˜“ç”¨æ€§*
| - åŸºæ–¼ Promiseï¼Œèªæ³•æ›´ç°¡æ½” +
  - æ›´æ˜“æ–¼é–±è®€å’Œç¶­è­·
| - åŸºæ–¼å›èª¿å‡½æ•¸ï¼Œèªæ³•è¼ƒç‚ºç¹ç‘£ +
  - éœ€è¦è™•ç†å¤šå€‹äº‹ä»¶

| *éåŒæ­¥è™•ç†æ–¹å¼*
| - ä½¿ç”¨ Promise +
  - æ”¯æŒ `async/await` èªæ³•
| - ä½¿ç”¨äº‹ä»¶å’Œå›èª¿å‡½æ•¸ +
  - ä¸æ”¯æ´ Promise

| *åŒæ­¥è«‹æ±‚*
| - ä¸æ”¯æŒåŒæ­¥è«‹æ±‚
| - æ”¯æŒåŒæ­¥è«‹æ±‚ï¼ˆä½†å·²è¢«å»¢æ£„ï¼Œä¸æ¨è–¦ä½¿ç”¨ï¼‰

| *è«‹æ±‚æ””æˆªå’Œå–æ¶ˆ*
| - æ”¯æŒä½¿ç”¨ `AbortController` å–æ¶ˆè«‹æ±‚
| - å¯ä½¿ç”¨ `xhr.abort()` æ–¹æ³•å–æ¶ˆè«‹æ±‚

| *è«‹æ±‚é€²åº¦ç›£è½*
| - ç„¡æ³•ç›´æ¥ç›£è½è«‹æ±‚é€²åº¦ +
  - ä¸æ”¯æ´ä¸Šå‚³é€²åº¦ç›£è½
| - æ”¯æŒ `onprogress` äº‹ä»¶ +
  - å¯ç›£è½ä¸‹è¼‰å’Œä¸Šå‚³é€²åº¦

| *éŒ¯èª¤è™•ç†*
| - åªæœ‰åœ¨ç¶²çµ¡éŒ¯èª¤æ™‚æœƒæ‹’çµ• Promise +
  - HTTP éŒ¯èª¤ï¼ˆå¦‚ 404ã€500ï¼‰ä¸æœƒæ‹‹å‡ºéŒ¯èª¤ï¼Œéœ€è¦æ‰‹å‹•æª¢æŸ¥ `response.ok`
| - å¯é€šé `xhr.status` åˆ¤æ–· HTTP ç‹€æ…‹ç¢¼ +
  - åœ¨éŒ¯èª¤æ™‚è§¸ç™¼ `onerror` äº‹ä»¶

| *Response é¡å‹*
| - æ”¯æŒå¤šç¨® Response é¡å‹ï¼Œå¦‚ `response.json()`ã€`response.text()`ã€`response.blob()`ã€`response.arrayBuffer()`ã€`response.formData()`
| - Response å­˜å„²åœ¨ `responseText`ï¼ˆå­—ç¬¦ä¸²ï¼‰å’Œ `responseXML`ï¼ˆXML æ–‡æª”ï¼‰ä¸­

| *Request header è¨­ç½®*
| - ä½¿ç”¨ `Headers` ç‰©ä»¶è¨­ç½® Request header +
  - æŸäº›é ­éƒ¨ä¸å¯ä¿®æ”¹ï¼ˆå¦‚ `Referer`ã€`User-Agent`ï¼‰
| - ä½¿ç”¨ `setRequestHeader()` æ–¹æ³•è¨­ç½® Request header +
  - å¯ä»¥è¨­ç½®æ›´å¤šè‡ªå®šç¾©é ­éƒ¨

| *è·¨åŸŸè«‹æ±‚ï¼ˆCORSï¼‰*
| - é»˜èªæ¡ç”¨ CORS +
  - æ”¯æŒè·¨åŸŸè«‹æ±‚ï¼Œä½†éœ€è¦ä¼ºæœå™¨å…è¨±
| - éœ€è¦é¡å¤–è¨­å®šæ‰èƒ½é€²è¡Œè·¨åŸŸè«‹æ±‚ +
  - å¯èƒ½å—åˆ°æ›´å¤šé™åˆ¶

| *æµå¼è™•ç†*
| - æ”¯æŒæµå¼ Responseï¼ˆStreamingï¼‰ +
  - å¯é€æ­¥è™•ç†å¤§å‹æ•¸æ“š
| - ä¸æ”¯æŒæµå¼ Response +
  - å¿…é ˆåœ¨ Response å®Œå…¨æ¥æ”¶å¾Œæ‰èƒ½è™•ç†

| *è«‹æ±‚å–æ¶ˆï¼ˆAbortï¼‰*
| - æ”¯æŒä½¿ç”¨ `AbortController` å–æ¶ˆè«‹æ±‚
| - å¯ä½¿ç”¨ `xhr.abort()` æ–¹æ³•å–æ¶ˆè«‹æ±‚

| *è¶…æ™‚è¨­ç½®*
| - ä¸ç›´æ¥æ”¯æŒè¶…æ™‚è¨­ç½® +
  - éœ€è¦ä½¿ç”¨ `Promise.race()` å¯¦ç¾è¶…æ™‚æ§åˆ¶
| - æ”¯æŒ `xhr.timeout` å±¬æ€§è¨­ç½®è¶…æ™‚æ™‚é–“ +
  - å¯ç›£è½ `ontimeout` äº‹ä»¶

| *ä¸Šå‚³æ–‡ä»¶*
| - æ”¯æŒé€šé `fetch` ä¸Šå‚³æ–‡ä»¶ +
  - ä½†ç„¡æ³•ç›£è½ä¸Šå‚³é€²åº¦
| - æ”¯æŒä¸Šå‚³æ–‡ä»¶ +
  - å¯é€šé `xhr.upload.onprogress` ç›£è½ä¸Šå‚³é€²åº¦

| *è‡ªå‹•ç™¼é€ Cookie*
| - é»˜èªä¸ç™¼é€ Cookie +
  - éœ€è¦è¨­ç½® `credentials` é¸é … +
  - `credentials: 'same-origin'` æˆ– `credentials: 'include'`
| - é»˜èªæœƒç™¼é€ä¸¦æ¥æ”¶ Cookie +
  - å¯é€šé `withCredentials` å±¬æ€§æ§åˆ¶

| *HTTP Response ç¢¼è™•ç†*
| - éœ€è¦æ‰‹å‹•æª¢æŸ¥ `response.ok` æˆ– `response.status` ä¾†åˆ¤æ–·æ˜¯å¦æˆåŠŸ
| - å¯ç›´æ¥é€šé `xhr.status` åˆ¤æ–·è«‹æ±‚æ˜¯å¦æˆåŠŸ

| *åŸç”Ÿæ”¯æ´åº¦*
| - ç¾ä»£ç€è¦½å™¨åŸç”Ÿæ”¯æŒ +
  - IE ä¸æ”¯æŒ Fetch APIï¼Œéœ€è¦ä½¿ç”¨ polyfill
| - æ‰€æœ‰ä¸»æµç€è¦½å™¨å‡æ”¯æŒï¼ŒåŒ…æ‹¬è¼ƒèˆŠç‰ˆæœ¬çš„ IE

| *èª¿è©¦å’Œè¿½è¹¤*
| - èª¿è©¦è¼ƒç‚ºå›°é›£ï¼ŒéŒ¯èª¤ä¿¡æ¯å¯èƒ½ä¸å¤ è©³ç´°
| - èª¿è©¦è¼ƒç‚ºæ–¹ä¾¿ï¼Œå¯åœ¨é–‹ç™¼è€…å·¥å…·ä¸­æŸ¥çœ‹è«‹æ±‚è©³ç´°ä¿¡æ¯

| *HTTP æ”¹å¯«æˆ–é‡å°å‘*
| - `fetch` æœƒè‡ªå‹•è™•ç† HTTP é‡å°å‘ +
  - å¯è¨­ç½® `redirect` é¸é …æ§åˆ¶
| - éœ€è¦æ‰‹å‹•è™•ç†é‡å°å‘ï¼Œè¼ƒç‚ºéº»ç…©

| *å®‰å…¨æ€§*
| - éµå¾ªåš´æ ¼çš„ CORS æ”¿ç­– +
  - æŸäº›é ­éƒ¨ä¸å¯ä¿®æ”¹ï¼Œå¢å¼·å®‰å…¨æ€§
| - å¯èƒ½å­˜åœ¨è¢«åˆ©ç”¨çš„é¢¨éšªï¼Œéœ€è¦è¬¹æ…è™•ç†

| *ä½¿ç”¨å ´æ™¯*
| - é©åˆç¾ä»£åŒ–çš„æ‡‰ç”¨é–‹ç™¼ +
  - éœ€è¦è™•ç† Promise çš„æƒ…æ³
| - é©åˆéœ€è¦å…¼å®¹èˆŠç€è¦½å™¨ +
  - éœ€è¦ç›£è½é€²åº¦æˆ–åŒæ­¥è«‹æ±‚

| *API éˆæ´»æ€§*
| - API ç°¡æ½”ä½†æŸäº›åŠŸèƒ½æœ‰é™ +
  - éœ€è¦çµåˆå…¶ä»– APIï¼ˆå¦‚ Streamsã€AbortControllerï¼‰å¯¦ç¾é«˜ç´šåŠŸèƒ½
| - API åŠŸèƒ½å…¨é¢ +
  - æ”¯æŒæ›´å¤šç´°ç¯€æ§åˆ¶å’Œè¨­å®š
|===



[id=promise_async_handling]
== Promise èˆ‡éåŒæ­¥è™•ç†

[id=what_is_promise]
=== Promise

Promise ç…§å­—é¢æ„æ€æ˜¯ã€Œæ‰¿è«¾ã€ï¼Œå®ƒä»£è¡¨çš„æ˜¯ä¸€å€‹éåŒæ­¥æ“ä½œåœ¨æœªä¾†æŸå€‹æ™‚åˆ»æœƒè¿”å›æ•¸æ“šæˆ–éŒ¯èª¤çµ¦èª¿ç”¨è€…ã€‚Promise åªæœƒåœ¨æ“ä½œæˆåŠŸï¼ˆæˆ–å¤±æ•—ï¼‰æ™‚è¿”å›ä¸€æ¬¡çµæœã€‚æ ¹æ“š MDN æ–‡ä»¶çš„å®šç¾©ï¼ŒPromise ç”¨ä¾†è¡¨ç¤ºä¸€å€‹éåŒæ­¥æ“ä½œçš„æœ€çµ‚å®Œæˆï¼ˆresolvedï¼‰æˆ–å¤±æ•—ï¼ˆrejectedï¼‰åŠå…¶çµæœå€¼ã€‚

[id=promise_states]
==== Promise çš„ç‹€æ…‹


* *pending*ï¼šåˆå§‹ç‹€æ…‹ï¼Œè¡¨ç¤º Promise å°šæœªå®Œæˆã€‚

* *fulfilled*ï¼šè¡¨ç¤ºæ“ä½œæˆåŠŸï¼Œä¸¦ä¸”è¿”å›äº†çµæœï¼ˆåŸ·è¡Œäº† #resolve()#ï¼‰ã€‚

* *rejected*ï¼šè¡¨ç¤ºæ“ä½œå¤±æ•—ï¼Œä¸¦ä¸”è¿”å›äº†éŒ¯èª¤ï¼ˆåŸ·è¡Œäº† #reject()#ï¼‰ã€‚

ç•¶ Promise ç‹€æ…‹å¾ *pending* è®Šç‚º *fulfilled* æˆ– *rejected* å¾Œï¼Œå…¶ç‹€æ…‹å°±æœƒä¿æŒä¸è®Šï¼Œç„¡æ³•å†æ¬¡æ”¹è®Šã€‚


[id=promise_structure]
==== Promise åŸºæœ¬çµæ§‹

Promise çš„åŸºæœ¬çµæ§‹å¦‚ä¸‹ï¼Œå®ƒæ¥å—å…©å€‹å›èª¿å‡½æ•¸ä½œç‚ºåƒæ•¸ï¼š#resolve#ï¼ˆæ“ä½œæˆåŠŸæ™‚èª¿ç”¨ï¼‰å’Œ #reject#ï¼ˆæ“ä½œå¤±æ•—æ™‚èª¿ç”¨ï¼‰ï¼š

[source,javascript]
----

let promise = new Promise((resolve, reject) => {
    let success = true;

    if (success) {
        resolve('æ“ä½œæˆåŠŸ');
    } else {
        reject('æ“ä½œå¤±æ•—');
    }
});

promise.then(result => {
    console.log(result);// è¼¸å‡º 'æ“ä½œæˆåŠŸ'
})
.catch(error => {
    console.error(error);// è¼¸å‡º 'æ“ä½œå¤±æ•—'
});

----

[id=promise_chain_structure]
==== Promise éˆå¼çµæ§‹

Promise çš„ä¸€å€‹å¼·å¤§åŠŸèƒ½æ˜¯å®ƒå¯ä»¥éˆå¼èª¿ç”¨ï¼Œé€™è®“æˆ‘å€‘èƒ½å¤ ä¾æ¬¡è™•ç†å¤šå€‹ç•°æ­¥æ“ä½œã€‚æ¯å€‹ #.then()# è¿”å›ä¸€å€‹æ–°çš„ Promiseï¼Œå…è¨±æˆ‘å€‘é€²ä¸€æ­¥é€²è¡Œè™•ç†ã€‚


[source,javascript]
----

fetch("https://openlibrary.org/search.json?q=the+lord+of+the+rings")
    .then(response => {
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json(); // è¿”å›è§£æå¾Œçš„ JSON æ•¸æ“š
    })
    .then(data => {
        console.log(data);// è™•ç†è§£æå¾Œçš„æ•¸æ“š
    })
    .catch(error => {
        console.error(error); // æ•ç²ç•°å¸¸ï¼Œè™•ç†éŒ¯èª¤
    });

----

[id=promise_flexibility]
=== Promiseçš„éˆæ´»é‹ç”¨

Promise é‚„æä¾›äº†å¤šç¨®å¼·å¤§çš„æ–¹æ³•ä¾†è™•ç†å¤šå€‹ç•°æ­¥æ“ä½œï¼Œå¦‚ #Promise.all()#, #Promise.allSettled()#, #Promise.race()#, å’Œ #Promise.any()#ã€‚æ¯å€‹æ–¹æ³•éƒ½æœ‰ä¸åŒçš„ç”¨é€”å’Œè¡Œç‚ºï¼Œé©åˆä¸åŒçš„ç•°æ­¥å ´æ™¯ã€‚


[id=promise_all]
==== 1. `Promise.all()`


*Promise.all()* ä¸¦è¡ŒåŸ·è¡Œæ‰€æœ‰å‚³å…¥çš„
Promiseï¼Œé€™å°æé«˜æ•ˆç‡éå¸¸é‡è¦ï¼Œå°¤å…¶æ˜¯ç•¶ä½ éœ€è¦ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹è€—æ™‚çš„æ“ä½œæ™‚ï¼ˆå¦‚å¤šå€‹ç¶²è·¯è«‹æ±‚ï¼‰ã€‚



[id=promise_all_example]
==== `Promise.all()` å¯¦éš›ç¯„ä¾‹

[source,javascript]
----

const fetchGatsby = fetch("https://openlibrary.org/search.json?q=the+great+gatsby")
.then(response => response.json());

const fetchLordOfTheRings = fetch("https://openlibrary.org/search.json?q=the+lord+of+the+ring")
.then(response => response.json());

const fetchPrideAndPrejudice = fetch("https://openlibrary.org/search.json?q=pride+and+prejudice")
.then(response => response.json());

Promise.all([fetchGatsby, fetchLordOfTheRings, fetchPrideAndPrejudice])
    .then(([gatsbyData, lotrData, prideData]) => {
        console.log('The Great Gatsby:', gatsbyData);
        console.log('The Lord of the Rings:', lotrData);
        console.log('Pride and Prejudice:', prideData);
    })
    .catch(error => {
        console.error('Error fetching data:', error);
});

----

[id=promise_allsettled]
==== 2. `Promise.allSettled()`

*Promise.allSettled()* æœƒç­‰å¾…æ‰€æœ‰çš„ Promise éƒ½å·²å®Œæˆï¼Œä¸è«–å®ƒå€‘æ˜¯æˆåŠŸé‚„æ˜¯å¤±æ•—ã€‚é€™å°æ–¼ä½ å¸Œæœ›åœ¨æ‰€æœ‰æ“ä½œéƒ½çµæŸå¾Œå†é€²è¡Œè™•ç†ï¼Œè€Œä¸å› ç‚ºæŸä¸€å€‹æ“ä½œçš„å¤±æ•—ä¸­æ–·æ•´å€‹æµç¨‹æ™‚éå¸¸æœ‰ç”¨ã€‚


[id=promise_allsettled_example]
==== `Promise.allSettled()` å¯¦éš›ç¯„ä¾‹

[source,javascript]
----

Promise.allSettled([fetchGatsby, fetchLordOfTheRings, fetchPrideAndPrejudice])
    .then(results => {
        results.forEach(result => {
            if (result.status === 'fulfilled') {
                console.log('æˆåŠŸ:', result.value);
            } else {
                console.log('å¤±æ•—:', result.reason);
            }
    });
});

----

[id=promise_race]
==== 3. `Promise.race()`

*Promise.race()* è¿”å›ç¬¬ä¸€å€‹è§£æ±ºæˆ–æ‹’çµ•çš„ Promiseã€‚ç„¡è«–æ˜¯å“ªå€‹ Promise æœ€å…ˆå®Œæˆï¼ˆæˆåŠŸæˆ–å¤±æ•—ï¼‰ï¼Œå®ƒéƒ½æœƒå°‡çµæœä½œç‚ºæ–°çš„ Promise è¿”å›ã€‚å¦‚æœä½ åªéœ€è¦ç¬¬ä¸€å€‹å®Œæˆçš„çµæœï¼Œé€™æ˜¯ä¸€å€‹éå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚


[id=promise_race_example]
==== `Promise.race()` å¯¦éš›ç¯„ä¾‹

[source,javascript]
----

const fetchSlower = new Promise(resolve => setTimeout(resolve, 2000, 'æ…¢çš„'));
const fetchFaster = new Promise(resolve => setTimeout(resolve, 1000, 'å¿«çš„'));

Promise.race([fetchSlower, fetchFaster])
    .then(result => {
        console.log(result);// åªè¿”å› 'å¿«çš„'
    })
    .catch(error => {
        console.error(error);
    });

----

[id=promise_any]
==== 4. `Promise.any()`

*Promise.any()* æœƒè¿”å›ç¬¬ä¸€å€‹æˆåŠŸçš„ Promiseï¼Œä¸¦å¿½ç•¥æ‰€æœ‰å¤±æ•—çš„ Promiseã€‚å¦‚æœæ‰€æœ‰çš„ Promise éƒ½è¢«æ‹’çµ•ï¼Œå®ƒæœƒè¿”å›ä¸€å€‹æ‹’çµ•çš„ Promiseã€‚é€™å°æ–¼ä½ åªé—œå¿ƒç¬¬ä¸€å€‹æˆåŠŸçµæœï¼Œè€Œä¸åœ¨æ„å¤±æ•—æ™‚éå¸¸æœ‰ç”¨ã€‚


[id=promise_any_example]
==== `Promise.any()` å¯¦éš›ç¯„ä¾‹

[source,javascript]
----

const failedFetch1 = new Promise((_, reject) => setTimeout(reject, 1000, 'å¤±æ•— 1'));
const failedFetch2 = new Promise((_, reject) => setTimeout(reject, 1500, 'å¤±æ•— 2'));
const successfulFetch = new Promise(resolve => setTimeout(resolve, 500, 'æˆåŠŸ'));

Promise.any([failedFetch1, failedFetch2, successfulFetch])
    .then(result => {
        console.log(result);// è¿”å› 'æˆåŠŸ'
    })
    .catch(error => {
        console.error('æ‰€æœ‰ Promise éƒ½å¤±æ•—:', error);
    });

----


[id=promise_methods_comparison]
==== Promise æ–¹æ³•æ¯”è¼ƒ

[cols="1,2,2,2,2", options="header", frame="all", grid="all"]
|===
| æ–¹æ³• | åŠŸèƒ½ | æˆåŠŸè™•ç† | å¤±æ•—è™•ç† | é©ç”¨å ´æ™¯

| `Promise.all()`
| ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹ Promiseï¼Œç­‰å¾…å…¨éƒ¨æˆåŠŸ
| è¿”å›ä¸€å€‹åŒ…å«æ‰€æœ‰çµæœçš„é™£åˆ—
| ç•¶ä»»ä¸€ Promise å¤±æ•—ï¼Œè¿”å›å¤±æ•—çš„ Promise
| å¸Œæœ›æ‰€æœ‰ç•°æ­¥æ“ä½œéƒ½æˆåŠŸï¼Œä»»ä½•å¤±æ•—éƒ½æœƒä¸­æ–·æµç¨‹æ™‚

| `Promise.allSettled()`
| ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹ Promiseï¼Œç­‰å¾…å…¨éƒ¨å®Œæˆ
| è¿”å›æ¯å€‹ Promise çš„ç‹€æ…‹å’Œçµæœ
| ä¸æœƒä¸­æ–·ï¼Œæ‰€æœ‰ Promise çµæœéƒ½æœƒè¢«è¿”å›
| éœ€è¦ç²å¾—æ¯å€‹ Promise çš„å®Œæ•´çµæœï¼Œä¸é—œå¿ƒæˆåŠŸæˆ–å¤±æ•—æ™‚

| `Promise.race()`
| è¿”å›ç¬¬ä¸€å€‹å®Œæˆçš„ Promise
| æœ€å…ˆå®Œæˆçš„ Promise çš„çµæœæœƒè¢«è¿”å›
| æœ€å…ˆå¤±æ•—çš„ Promise çš„éŒ¯èª¤æœƒè¢«è¿”å›
| åªéœ€è¦æœ€å…ˆå®Œæˆçš„çµæœï¼Œç„¡è«–æˆåŠŸé‚„æ˜¯å¤±æ•—

| `Promise.any()`
| è¿”å›ç¬¬ä¸€å€‹æˆåŠŸçš„ Promise
| æœ€å…ˆæˆåŠŸçš„ Promise çš„çµæœæœƒè¢«è¿”å›
| åªæœ‰ç•¶æ‰€æœ‰ Promise éƒ½å¤±æ•—æ™‚æ‰è¿”å›ä¸€å€‹æ‹’çµ•çš„ Promise
| åªé—œå¿ƒæœ‰ä¸€å€‹æˆåŠŸçµæœï¼Œä¸åœ¨æ„å¤±æ•—çš„ Promise
|===




























== éåŒæ­¥(async/awaitã€tryâ€¦â€‹catch èˆ‡éåŒæ­¥)

== async/await æ˜¯ä»€éº¼ï¼Ÿ

== 1. async èªæ³•
ä½¿ç”¨ async é—œéµå­—è²æ˜çš„å‡½å¼ç‚ºéåŒæ­¥å‡½å¼ï¼ŒéåŒæ­¥å‡½å¼æœƒè¿”å›ä¸€å€‹ Promise ç‰©ä»¶ï¼Œè€Œéç›´æ¥è¿”å›å‡½å¼åŸ·è¡Œçš„çµæœã€‚è®“æˆ‘å€‘é€éç¯„ä¾‹ä¾†äº†è§£:

=== æ™®é€šå‡½å¼ï¼š
[source, javascript]
----
function f1() {
    return "Hello! ExplainThis!";
}

f1(); // è¼¸å‡º: "Hello! ExplainThis!"
----

ä½¿ç”¨ async æ™‚ï¼Œæœƒè‡ªå‹•å°‡å›å‚³å€¼åŒ…è£åœ¨ä¸€å€‹ Promise ç‰©ä»¶ç•¶ä¸­ï¼š

[source, javascript]
----
async function f2() {
    return "Hello! ExplainThis!";
}

f2(); // è¼¸å‡º: Promise {<fulfilled>: 'Hello! ExplainThis!'}
----

== 2. await èªæ³•
await æ˜¯ä¸€å€‹é‹ç®—å­ï¼Œç”¨æ–¼ç­‰å¾…ä¸€å€‹ Promise å®Œæˆæˆ–æ‹’çµ•ã€‚å®ƒé€šå¸¸èˆ‡ async å‡½å¼ä¸€èµ·ä½¿ç”¨ï¼Œå› ç‚ºåªæœ‰åœ¨ async å‡½å¼å…§éƒ¨æˆ–æ¨¡çµ„çš„é ‚å±¤ï¼Œæ‰èƒ½ä½¿ç”¨ awaitã€‚ç•¶ä½¿ç”¨ await æ™‚ï¼Œç¨‹å¼æœƒæš«åœåŸ·è¡Œè©² async å‡½å¼ï¼Œç›´åˆ° await ç­‰å¾…çš„ Promise å®Œæˆä¸¦å›å‚³çµæœå¾Œï¼Œæ‰æœƒç¹¼çºŒå¾€ä¸‹åŸ·è¡Œã€‚

[source, javascript]
----
async function getData() {
    // await ç­‰å¾… fetch é€™å€‹éåŒæ­¥å‡½å¼è¿”å›ä¸€å€‹ Promise ä¸¦è§£æå®ƒ
    const res = await fetch("https://example.com/data");

    // await ç­‰å¾…ä¸Šä¸€æ­¥çš„ Promise è§£æå¾Œï¼Œå†è§£æå®ƒçš„ JSON è³‡æ–™
    const data = await res.json();

    // å‰é¢å…©æ­¥éƒ½å®Œæˆå¾Œï¼Œæ‰æœƒåŸ·è¡Œé€™ä¸€è¡Œä¸¦å°å‡ºè³‡æ–™
    console.log(data);
}

getData();
----

=== ä½¿ç”¨ await è¦æ³¨æ„çš„åœ°æ–¹ï¼š
åœ¨é async å‡½å¼ä¸­ä½¿ç”¨ await æœƒå ± SyntaxError çš„éŒ¯èª¤

[source, javascript]
----
function f() {
    let promise = Promise.resolve("Hello! ExplainThis!");
    let result = await promise;
}

// Uncaught SyntaxError: await is only valid in async functions and the top level bodies of modules
----

== 3. ç”¨ Promise ä¾†å¯«ä¸€å€‹ getData å‡½å¼çš„ä¾‹å­ï¼š
[source, javascript]
----
function getData() {
    fetch(url)
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json(); // å°‡å›æ‡‰è½‰æ›ç‚ºJSON
        })
        .then(data => console.log(data)) // è™•ç†å–å¾—çš„è³‡æ–™
        .catch(error => console.error('There was a problem with the fetch operation:', error)); // æ•ç²ä¸¦è™•ç†éŒ¯èª¤
}

getData();
----

== 4. ä½¿ç”¨ async/await é‡å¯«ï¼š
[source, javascript]
----
async function getData(url) {
    try {
        const response = await fetch(url);
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        const data = await response.json();   // å°‡å›æ‡‰è½‰æ›ç‚ºJSON
        console.log(data);      // è™•ç†å–å¾—çš„è³‡æ–™
    } catch (error) {
        console.error(error);   // æ•ç²ä¸¦è™•ç†éŒ¯èª¤
    }
}

getData("https://example.com/data");
----

== 5. Async/Await çš„å„ªç¼ºé»
=== é©åˆæƒ…å¢ƒï¼š
- ç•¶æœ‰é †åºä¾è³´çš„éåŒæ­¥æ“ä½œæ™‚ï¼Œasync/await å¯ä»¥è®“ç¨‹å¼ç¢¼æ›´åŠ ç›´è§€å’Œæ¸…æ™°ã€‚

=== å„ªé»ï¼š
- ä½¿éåŒæ­¥ç¨‹å¼ç¢¼çœ‹èµ·ä¾†åƒåŒæ­¥ç¨‹å¼ç¢¼ï¼Œæ˜“æ–¼é–±è®€å’Œç¶­è­·ã€‚
- å¯ä»¥ä½¿ç”¨ try/catch ä¾†çµ±ä¸€è™•ç†éŒ¯èª¤ï¼Œæ¯” Promise çš„ catch() éˆæ¢æ›´æ¸…æ™°ã€‚

=== ç¼ºé»ï¼š
- ç•¶éœ€è¦åŸ·è¡Œå¤šå€‹éåŒæ­¥æ“ä½œä¸”å½¼æ­¤ç„¡ä¾è³´æ€§æ™‚ï¼Œasync/await æœƒé †åºåŸ·è¡Œï¼Œç„¡æ³•ä¸¦è¡Œã€‚é€™æ™‚éœ€è¦è¼”ä»¥ Promise.all ä¾†è§£æ±ºã€‚
- åœ¨æŸäº›æƒ…æ³ä¸‹å¯èƒ½æœƒé™ä½æ€§èƒ½ï¼Œç‰¹åˆ¥æ˜¯æœ‰å¤šå€‹ä¸ç›¸é—œçš„éåŒæ­¥æ“ä½œæ™‚ã€‚

=== Promise.all å’Œ Async/Await çš„åˆä½µè™•ç†
Promise.allç¯„ä¾‹

[source, javascript]
----
Promise.all([fetchData('valid-url'), fetchData('another-valid-url')])
    .then(responses => {
        console.log(responses[0]);  // ç¬¬ä¸€å€‹è«‹æ±‚çš„çµæœ
        console.log(responses[1]);  // ç¬¬äºŒå€‹è«‹æ±‚çš„çµæœ
    })
    .catch(error => {
        console.error(error);
    });
----

åˆ©ç”¨async/awaitæ”¹å¯«

[source, javascript]
----
async function fetchConcurrentData() {
    try {
        const [response1, response2] = await Promise.all([
            fetchData('valid-url'),
            fetchData('another-valid-url')
        ]);
        console.log(response1);
        console.log(response2);
    } catch (error) {
        console.error(error);
    }
}

fetchConcurrentData();
----

Promise.all è®“ async/await æ”¯æ´ä½µç™¼è™•ç†ï¼Œé¿å…é †åºåŸ·è¡Œé™ä½æ•ˆèƒ½ã€‚

== 6. async/await çš„ä½¿ç”¨ç¯„ä¾‹
=== 1. èˆ‡ for...of æ­é…ï¼š
åœ¨éœ€è¦é †åºè™•ç†éåŒæ­¥æ“ä½œæ™‚ï¼Œå¯ä»¥çµåˆ for...of èˆ‡ async/awaitï¼Œè®“æ¯æ¬¡è¿­ä»£éƒ½ç­‰å¾…ä¸Šä¸€å€‹éåŒæ­¥æ“ä½œå®Œæˆå¾Œå†é€²è¡Œä¸‹ä¸€å€‹ï¼Œé¿å…å®ƒå€‘åŒæ™‚åŸ·è¡Œã€‚

[source, javascript]
----
async function processItems(items) {
    for (let item of items) {
        await new Promise(resolve => setTimeout(resolve, 1000));  // æ¨¡æ“¬éåŒæ­¥æ“ä½œ
        console.log(item);
    }
}

processItems([1, 2, 3, 4]);  // æ¯éš” 1 ç§’è¼¸å‡ºä¸€å€‹æ•¸å­—
----

=== 2. èˆ‡ Array.prototype.map æ­é…ï¼š
map æ–¹æ³•å¯ä»¥ç”¨ä¾†å°é™£åˆ—ä¸­çš„æ¯å€‹å…ƒç´ é€²è¡Œæ“ä½œï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œmap æœ¬èº«ä¸æœƒç­‰å¾…éåŒæ­¥æ“ä½œå®Œæˆï¼Œæ‰€ä»¥éœ€è¦çµåˆ Promise.all ä¾†ç­‰å¾…æ‰€æœ‰éåŒæ­¥æ“ä½œå®Œæˆå¾Œï¼Œç²å–æœ€çµ‚çµæœã€‚

==== éŒ¯èª¤ç”¨æ³•ï¼š
[source, javascript]
----
const items = [1, 2, 3];

async function processItems() {
    const results = items.map(async (item) => {
        await new Promise(resolve => setTimeout(resolve, 1000));
        return item * 2;
    });
    console.log(results);  // é€™è£¡è¼¸å‡ºçš„æœƒæ˜¯ Promise é™£åˆ—
}

processItems();
----

==== æ­£ç¢ºç”¨æ³•ï¼š
[source, javascript]
----
const items = [1, 2, 3];

async function processItems() {
    const results = await Promise.all(items.map(async (item) => {
        await new Promise(resolve => setTimeout(resolve, 1000));
        return item * 2;
    }));
    console.log(results);  // [2, 4, 6]
}

processItems();
----

=== 3. èˆ‡ reduce æ­é…ï¼š
å¦‚æœéœ€è¦å°‡éåŒæ­¥æ“ä½œç´¯åŠ æˆ–éˆå¼åŸ·è¡Œï¼Œå¯ä»¥å°‡ reduce èˆ‡ async/await æ­é…ä½¿ç”¨ï¼Œè®“æ¯æ¬¡æ“ä½œéƒ½ç­‰å¾…ä¸Šä¸€æ¬¡å®Œæˆå¾Œå†åŸ·è¡Œã€‚accPromise ç¢ºä¿æ¯å€‹éåŒæ­¥æ­¥é©Ÿä¾æ¬¡åŸ·è¡Œä¸¦è¿”å›çµæœã€‚

[source, javascript]
----
async function processSequentially(items) {
    const result = await items.reduce(async (accPromise, item) => {
        const acc = await accPromise;
        const value = await new Promise(resolve => setTimeout(() => resolve(item * 2), 1000));
        return acc + value;
    }, Promise.resolve(0));

    console.log(result);  // ç´¯åŠ çµæœ
}

processSequentially([1, 2, 3]);
----

= try/catch éŒ¯èª¤è™•ç†

== 1. ä½¿ç”¨ Promise + .then() å’Œ .catch() è™•ç†éŒ¯èª¤
åœ¨æ­¤ç¯„ä¾‹ä¸­ï¼Œä½¿ç”¨ .catch() ä¾†è™•ç†éŒ¯èª¤ï¼Œä½†å¦‚æœæœ‰å¤šå±¤ .then()ï¼ŒéŒ¯èª¤è™•ç†çš„é‚è¼¯æœƒæ¯”è¼ƒåˆ†æ•£ã€‚

[source, javascript]
----
function fetchDataWithPromise() {
    fetch('https://api.example.com/data1')
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch data1');
            }
            return response.json();
        })
        .then(data1 => {
            console.log('Data1:', data1);
            return fetch('https://api.example.com/data2');
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch data2');
            }
            return response.json();
        })
        .then(data2 => {
            console.log('Data2:', data2);
            return fetch('https://api.example.com/data3');
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to fetch data3');
            }
            return response.json();
        })
        .then(data3 => {
            console.log('Data3:', data3);
        })
        .catch(error => {
            console.error('Error occurred:', error.message);
        });
}

fetchDataWithPromise();
----

æˆ‘å€‘ä¸²æ¥äº†å¤šå€‹ .then() ä¾†è™•ç†ä¸åŒçš„ API è«‹æ±‚ï¼Œæ¯å€‹è«‹æ±‚éƒ½æœ‰å„è‡ªçš„éŒ¯èª¤è™•ç†é‚è¼¯ã€‚å¦‚æœå…¶ä¸­ä»»ä½•ä¸€å€‹è«‹æ±‚å¤±æ•—ï¼ŒéŒ¯èª¤æœƒå‚³éåˆ°æœ€å¾Œçš„ .catch()ã€‚

== 2. ä½¿ç”¨ async/await èˆ‡ try/catch é›†ä¸­éŒ¯èª¤è™•ç†
é€™å€‹æ–¹æ³•å°‡éåŒæ­¥æ“ä½œåŒ…è£¹åœ¨ä¸€å€‹ try/catch å€å¡Šä¸­ï¼Œæ‰€æœ‰çš„éŒ¯èª¤è™•ç†éƒ½é›†ä¸­åœ¨ä¸€èµ·ï¼Œæ›´é©åˆè™•ç†å¤šå±¤æ¬¡çš„éåŒæ­¥æ“ä½œï¼Œç¨‹å¼ç¢¼çµæ§‹æ›´ç°¡æ½”ä¸€è‡´ã€‚

[source, javascript]
----
async function fetchDataWithAsyncAwait() {
    try {
        const response1 = await fetch('https://api.example.com/data1');
        if (!response1.ok) {
            throw new Error('Failed to fetch data1');
        }
        const data1 = await response1.json();
        console.log('Data1:', data1);

        const response2 = await fetch('https://api.example.com/data2');
        if (!response2.ok) {
            throw new Error('Failed to fetch data2');
        }
        const data2 = await response2.json();
        console.log('Data2:', data2);

        const response3 = await fetch('https://api.example.com/data3');
        if (!response3.ok) {
            throw new Error('Failed to fetch data3');
        }
        const data3 = await response3.json();
        console.log('Data3:', data3);
    } catch (error) {
        console.error('Error occurred:', error.message);
    }
}

fetchDataWithAsyncAwait();
----

å¦‚æœä»»ä½•ä¸€å€‹è«‹æ±‚å¤±æ•—ï¼ŒéŒ¯èª¤æœƒç›´æ¥è·³è½‰åˆ° catchï¼Œä¸éœ€è¦åœ¨æ¯å€‹ await å¾Œé¢ç‰¹åˆ¥é€²è¡ŒéŒ¯èª¤æ•æ‰ã€‚é€™ç¨®çµæ§‹ä½¿å¾—éŒ¯èª¤è™•ç†é‚è¼¯é›†ä¸­åœ¨ä¸€å€‹å€å¡Šå…§ï¼Œç¨‹å¼ç¢¼æ›´å®¹æ˜“ç¶­è­·ä¸”å¯è®€æ€§æ›´é«˜ã€‚

== çµè«–
- Promise æ›´é©åˆè™•ç†éœ€è¦ä½µç™¼çš„å¤šå€‹éç›¸ä¾çš„éåŒæ­¥æ“ä½œã€‚
- Async/Await æ›´é©åˆè™•ç†é †åºä¾è³´çš„éåŒæ­¥æ“ä½œï¼Œä½¿ç¨‹å¼ç¢¼æ›´å…·å¯è®€æ€§ã€‚
- è‹¥å¤šå€‹éåŒæ­¥æ“ä½œæ²’æœ‰ä¾è³´é—œä¿‚ï¼Œæ‡‰ä½¿ç”¨ Promise.all é€²è¡Œä½µç™¼è™•ç†ï¼Œç„¡è«–æ˜¯ç”¨æ–¼ Promise é‚„æ˜¯ async/awaitã€‚

å…©è€…åœ¨å¯¦å‹™ä¸­çš„é¸æ“‡ï¼Œæ‡‰æ ¹æ“šéåŒæ­¥æ“ä½œçš„æ•¸é‡å’Œä¾è³´æ€§ä¾†æ±ºå®šã€‚

